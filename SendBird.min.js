!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define(["SendBird"],n):"object"==typeof exports?exports.SendBird=n():e.SendBird=n()}("undefined"!=typeof self?self:this,function(){var e,n=!1,t="wss://ws.sendbird.com",s="https://api.sendbird.com";try{e=window.console||{log:function(){}}}catch(n){e={log:function(){}}}var r="undefined";try{r=navigator.userAgent.replace(/,/g,".")}catch(e){r="undefined"}var a,i="3.0.55",l="JS,"+r+","+i+",";var o=function(){try{if(document&&9===document.documentMode)return!0}catch(e){return!1}return!1}(),c=function(){try{if(document&&document.documentMode<=8)return!0}catch(e){return!1}return!1}();if(o||c){function u(){this.oldIE=!0,this.boundary="--------FormData"+Math.random(),this._fields=[]}"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e){for(var n=0;n<this.length;n++)e.apply(this,[this[n],n,this])}),u.prototype.append=function(e,n){this._fields.push([e,n])},u.prototype.toString=function(){var e=this.boundary,n="";return this._fields.forEach(function(t){if(n+="--"+e+"\r\n",t[1].name){var s=t[1];n+="Content-Disposition: form-data; name='"+t[0]+"'; filename='"+s.name+"'\r\n",n+="Content-Transfer-Encoding: base64\r\n",n+="Content-Type: "+s.type+"\r\n\r\n",n+=s.base64+"\r\n"}else n+="Content-Disposition: form-data; name='"+t[0]+"';\r\n\r\n",n+=t[1]+"\r\n"}),n+="--"+e+"--"},a=u}else if("undefined"==typeof window&&"undefined"==typeof FormData)try{a=require("form-data")}catch(e){}var d,h=function(e,n,t){if(t&&"function"==typeof t)if(e){var s=null;try{s=JSON.parse(e.response)}catch(e){}var r=s?s.message:null,a=s?s.code:null;t(n,new p(r,a))}else t(n,null)},I=function(e){for(var n in e)if(e.hasOwnProperty(n))return!1;return Array.isArray(e)?JSON.stringify(e)===JSON.stringify([]):JSON.stringify(e)===JSON.stringify({})},_=function(t){try{if("number"==typeof t)return!0;if("string"==typeof t){return/^\d+$/.test(t)}}catch(t){return n&&e.error(t),!1}},E=(d=function(){},function(e,n){d.prototype=new e,n.prototype=new d,n.super=e.prototype,n.prototype.constructor=n}),p=function(e,n){return this.name="SendBirdException",this.code=n||0,this.message=e,this};E(Error,p);var f,A={MessageTypeFilter:{ALL:0,USER:1,FILE:2,ADMIN:3}},g=function(e){return Object.keys(e).forEach(function(n){null!==e[n]&&void 0!==e[n]&&"object"==typeof e[n]&&(e[n]=g(e[n]))}),Object.freeze(e)},m=function(e){return JSON.parse(JSON.stringify(e))},N=function(){var o,u={};try{o="undefined"==typeof window?require("xhr2"):null}catch(e){o=null}if(o)try{var d=require("agentkeepalive"),f=require("agentkeepalive").HttpsAgent,N=new d({keepAlive:!0,timeout:6e4,keepAliveTimeout:6e4});u.httpAgent=N;var C=new f({keepAlive:!0,timeout:6e4,keepAliveTimeout:6e4});u.httpsAgent=C}catch(e){}var R=function(){var e;return o?(e=new o).nodejsSet(u):e=new XMLHttpRequest,e},U=function(n,t,s,r,i){var l=R();l.open(s,n),l.onload=function(){l.status>=200&&l.status<400?h(null,JSON.parse(l.responseText),i):h({status:l.status,statusText:l.statusText,response:l.responseText},null,i)},l.onerror=function(){h({status:404,statusText:"There was a connection error",response:JSON.stringify({message:"There was a connection error",code:J.NETWORK_ERROR})},null,i)};try{for(var o in r)l.setRequestHeader(o,r[o]?r[o]:"sendbird")}catch(e){}try{switch(s){case"get":case"GET":l.send();break;default:"undefined"!=typeof FormData&&FormData&&t instanceof FormData||void 0!==a&&a&&t instanceof a?t.oldIE?(l.setRequestHeader("Content-Type","multipart/form-data; boundary="+t.boundary),l.send(t.toString())):l.send(t):(l.setRequestHeader("Content-Type","application/json; charset=utf-8"),l.send(JSON.stringify(t)))}}catch(n){e.log("request.send() fail:"+n)}},v=!1,S=function(e,n,t){t&&"function"==typeof t&&(void 0===n&&(n=null),void 0===e&&(e=null),v?t(n,e):t(e,n))},y="",T=0,P=0,L=function(e){this.isOpenChannel=function(){return this.channelType===b.CHANNEL_TYPE_OPEN},this.isGroupChannel=function(){return this.channelType===b.CHANNEL_TYPE_GROUP},this.isUserMessage=function(){return this.messageType===L.MESSAGE_TYPE_USER},this.isAdminMessage=function(){return this.messageType===L.MESSAGE_TYPE_ADMIN},this.isFileMessage=function(){return this.messageType===L.MESSAGE_TYPE_FILE},this._update=function(e){this.messageId=e.hasOwnProperty("msg_id")?parseInt(e.msg_id):0,this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.createdAt=e.hasOwnProperty("ts")?parseInt(e.ts):0,this.updatedAt=e.hasOwnProperty("updated_at")?parseInt(e.updated_at):0,this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):b.CHANNEL_TYPE_GROUP;var n=this;(n.mentionedUsers=[],e.hasOwnProperty("mentioned_users"))&&e.mentioned_users.forEach(function(e){var t=new G(e);n.mentionedUsers.push(t)})},this.serialize=function(){var e=JSON.parse(JSON.stringify(this));return e.hasOwnProperty("_sender")&&(e.sender=e._sender,delete e._sender),g(e)},this.messageType=L.MESSAGE_TYPE_BASE,e&&this._update(e)};L.build=function(e,n){if(!e)return null;var t,s,r,a,i,l,o,c,u;switch(e.type){case"MESG":return t=new G(e.user),s=parseInt(e.message_id),r=String(e.message),a=String(e.data),i=parseInt(e.created_at),l=parseInt(e.updated_at),o=e.hasOwnProperty("custom_type")?String(e.custom_type):"",c=e.hasOwnProperty("translations")?e.translations:{},u=e.mentioned_users,new D(D.build("",s,t,n,r,a,o,c,i,l,u));case"FILE":t=new G(e.user),s=parseInt(e.message_id),r=String(e.message),i=parseInt(e.created_at),l=parseInt(e.updated_at),o=e.hasOwnProperty("custom_type")?String(e.custom_type):"",u=e.mentioned_users;var d=e.file,h=String(d.url),I=String(d.name),_=String(d.type),E=parseInt(d.size)||0;a=String(d.data);var p=e.hasOwnProperty("thumbnails")?e.thumbnails:[],f=!!e.hasOwnProperty("require_auth")&&e.require_auth;return new M(M.build("",s,t,n,h,I,_,E,a,o,i,p,f,l,u));case"BRDM":case"ADMM":return s=parseInt(e.message_id),r=String(e.message),a=String(e.data),i=parseInt(e.created_at),l=parseInt(e.updated_at),o=e.hasOwnProperty("custom_type")?String(e.custom_type):"",c=e.hasOwnProperty("translations")?e.translations:{},u=e.mentioned_users,new O(O.build(s,n,r,a,o,c,i,l,u))}return null},L.MESSAGE_TYPE_BASE="base",L.MESSAGE_TYPE_ADMIN="admin",L.MESSAGE_TYPE_USER="user",L.MESSAGE_TYPE_FILE="file";var O=function(e){this.messageType=L.MESSAGE_TYPE_ADMIN,e&&(this._update(e),this.message=String(e.message),this.data=e.hasOwnProperty("data")?String(e.data):"",this.customType=e.hasOwnProperty("custom_type")?String(e.custom_type):"",this.translations=e.hasOwnProperty("translations")?e.translations:{})};E(L,O),O.build=function(e,n,t,s,r,a,i,l,o){var c={msg_id:e,channel_url:n.url,channel_type:n.channelType===b.CHANNEL_TYPE_OPEN?b.CHANNEL_TYPE_OPEN:b.CHANNEL_TYPE_GROUP,ts:i,updated_at:l,message:t,data:s};return r&&(c.custom_type=r),a&&(c.translations=a),c.mentioned_users=[],o&&(c.mentioned_users=o),c},O.buildFromSerializedData=function(e){var n=m(e),t=[];return n.mentionedUsers.forEach(function(e){t.push(G.build(e.userId,e.nickname,e.profileUrl,e.connectionStatus,e.lastSeenAt,e.metaData,e.isActive,e.friendDiscoveryKey,e.friendName))}),new O(O.build(n.messageId,{url:n.channelUrl,channelType:n.channelType},n.message,n.data,n.customType,n.translations,n.createdAt,n.updatedAt,t))};var D=function(e){this.messageType=L.MESSAGE_TYPE_USER,e&&(this._update(e),this.message=String(e.message),this.data=e.hasOwnProperty("data")?String(e.data):"",this._sender=new G(e.user),c?this.sender=this._sender:Object.defineProperty(this,"sender",{get:function(){if(se.getInstance().Options.UseMemberAsMessageSender&&this.isGroupChannel()){var e=H.cachedChannels[this.channelUrl];if(e){var n=e.memberMap[this._sender.userId];n&&(this._sender.nickname!==n.nickname&&(this._sender.nickname=n.nickname),this._sender.profileUrl!==n.profileUrl&&(this._sender.profileUrl=n.profileUrl),this._sender.metaData!==n.metaData&&(this._sender.metaData=n.metaData))}}return this._sender},set:function(e){this._sender=e}}),this.reqId=e.hasOwnProperty("req_id")?String(e.req_id):"",this.customType=e.hasOwnProperty("custom_type")?String(e.custom_type):"",this.translations=e.hasOwnProperty("translations")?e.translations:{})};E(L,D),D.build=function(e,n,t,s,r,a,i,l,o,c,u,d){var h={};h.req_id=e,h.msg_id=n,h.channel_url=s.url,h.channel_type=s.channelType===b.CHANNEL_TYPE_OPEN?b.CHANNEL_TYPE_OPEN:b.CHANNEL_TYPE_GROUP,h.ts=o,h.updated_at=c,h.message=r,a&&(h.data=a),i&&(h.custom_type=i),l&&(h.translations=l);var I={};I.user_id=t.userId,I.nickname=t.nickname,I.profile_url=t.profileUrl;try{I.metadata="string"==typeof t.metaData?JSON.parse(t.metaData):t.metaData}catch(e){I.metadata={}}return h.user=I,h.mentioned_users=[],u&&(h.mentioned_users=u),d&&(h.mentioned_user_ids=d),h},D.buildFromSerializedData=function(e){var n=m(e),t=[];return n.mentionedUsers.forEach(function(e){t.push(G.build(e.userId,e.nickname,e.profileUrl,e.connectionStatus,e.lastSeenAt,e.metaData,e.isActive,e.friendDiscoveryKey,e.friendName))}),new D(D.build(n.reqId,n.messageId,n.sender,{url:n.channelUrl,channelType:n.channelType},n.message,n.data,n.customType,n.translations,n.createdAt,n.updatedAt,t))};var M=function(e){if(this.messageType=L.MESSAGE_TYPE_FILE,e&&(this._update(e),this._sender=new G(e.user),c?this.sender=this._sender:Object.defineProperty(this,"sender",{get:function(){if(se.getInstance().Options.UseMemberAsMessageSender&&this.isGroupChannel()){var e=H.cachedChannels[this.channelUrl];if(e){var n=e.memberMap[this._sender.userId];n&&(this._sender.nickname!==n.nickname&&(this._sender.nickname=n.nickname),this._sender.profileUrl!==n.profileUrl&&(this._sender.profileUrl=n.profileUrl),this._sender.metaData!==n.metaData&&(this._sender.metaData=n.metaData))}}return this._sender},set:function(e){this._sender=e}}),this.requireAuth=!!e.hasOwnProperty("require_auth")&&e.require_auth,this.url=this.requireAuth?String(e.url).split("?auth=")[0]+"?auth="+Z.getInstance().ekey:String(e.url).split("?auth=")[0],this.name=e.hasOwnProperty("name")?e.name:"File",this.size=parseInt(e.size)||0,this.type=String(e.type),this.data=e.hasOwnProperty("custom")?String(e.custom):"",this.reqId=e.hasOwnProperty("req_id")?String(e.req_id):"",this.customType=e.hasOwnProperty("custom_type")?String(e.custom_type):"",this.thumbnails=e.hasOwnProperty("thumbnails")?e.thumbnails:[],this.requireAuth))for(var n in this.thumbnails)this.thumbnails[n].url=String(this.thumbnails[n].url).split("?auth=")[0]+"?auth="+Z.getInstance().ekey};E(L,M),M.build=function(e,n,t,s,r,a,i,l,o,c,u,d,h,I,_,E){var p={};p.req_id=e,p.msg_id=n,p.channel_url=s.url,p.channel_type=s.channelType===b.CHANNEL_TYPE_OPEN?b.CHANNEL_TYPE_OPEN:b.CHANNEL_TYPE_GROUP,p.ts=u,p.updated_at=I,p.url=r,p.name=a,p.type=i,p.size=l,p.custom=o;var f={};f.user_id=t.userId,f.nickname=t.nickname,f.profile_url=t.profileUrl;try{f.metadata=JSON.parse(t.metaData)}catch(e){f.metadata={}}return p.user=f,c&&(p.custom_type=c),h&&(p.require_auth=h),d&&(p.thumbnails=d),p.mentioned_users=[],_&&(p.mentioned_users=_),E&&(p.mentioned_user_ids=E),p},M.buildFromSerializedData=function(e){var n=m(e),t=[];return n.mentionedUsers.forEach(function(e){t.push(G.build(e.userId,e.nickname,e.profileUrl,e.connectionStatus,e.lastSeenAt,e.metaData,e.isActive,e.friendDiscoveryKey,e.friendName))}),new M(M.build(n.reqId,n.messageId,n.sender,{url:n.channelUrl,channelType:n.channelType},n.url,n.name,n.type,n.size,n.data,n.customType,n.createdAt,n.thumbnails,n.requireAuth,n.updatedAt,t))};var b=function(e){this._update=function(e){this.url=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.name=e.hasOwnProperty("name")?String(e.name):"",this.coverUrl=e.hasOwnProperty("cover_url")?String(e.cover_url):"",this.createdAt=e.hasOwnProperty("created_at")?1e3*e.created_at:0,this.data=e.hasOwnProperty("data")?String(e.data):"",this.customType=e.hasOwnProperty("custom_type")?e.custom_type:"",this.isFrozen=!!e.hasOwnProperty("freeze")&&e.freeze,this.isEphemeral=!!e.hasOwnProperty("is_ephemeral")&&e.is_ephemeral,this.fileUploadRequest={}},this.serialize=function(){var e=JSON.parse(JSON.stringify(this));if(e.hasOwnProperty("lastMessage")&&null!==e.lastMessage&&void 0!==e.lastMessage&&"object"==typeof e.lastMessage){var n=e.lastMessage;n.hasOwnProperty("_sender")&&(n.sender=n._sender,delete n._sender,e.lastMessage=n)}return g(e)},this.isGroupChannel=function(){return this.channelType===b.CHANNEL_TYPE_GROUP},this.isOpenChannel=function(){return this.channelType===b.CHANNEL_TYPE_OPEN},this.getMessageChangeLogsByToken=function(e,n){if("function"==typeof e&&(n=e,e=null),"function"!=typeof n)return null;Z.getInstance().getMessageChangeLogsByToken(this.isOpenChannel(),this.url,e,function(e,t){if(t)S(null,t,n);else{var s=e.updated.map(function(e){return L.build(e,this)}),r=e.deleted.map(function(e){return e.message_id}),a=e.has_more,i=e.next;S({updatedMessages:s,deletedMessageIds:r,hasMore:a,token:i},null,n)}})},this.createPreviousMessageListQuery=function(){return new q(this)},this.createMessageListQuery=function(){return new x(this)};var n=function(e,n,t,s,r,a,i,l,o){i===A.MessageTypeFilter.ADMIN?i="ADMM":i===A.MessageTypeFilter.USER?i="MESG":i===A.MessageTypeFilter.FILE?i="FILE":i===A.MessageTypeFilter.ALL&&(i=""),_(n)&&"boolean"==typeof t&&_(s)&&_(r)&&"boolean"==typeof a&&"string"==typeof i&&"string"==typeof l?Z.getInstance().messageList(e.isOpenChannel(),e.url,n,s,r,t,a,i,l,function(n,t){if(t)S(null,t,o);else{var s=n.messages,r=[];for(var a in s){var i=L.build(s[a],e);i&&r.push(i)}S(r,null,o)}}):S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),o)},t=function(e,n,t,s,r,a,i,l,o){i===A.MessageTypeFilter.ADMIN?i="ADMM":i===A.MessageTypeFilter.USER?i="MESG":i===A.MessageTypeFilter.FILE?i="FILE":i===A.MessageTypeFilter.ALL&&(i=""),_(n)&&"boolean"==typeof t&&_(s)&&_(r)&&"boolean"==typeof a&&"string"==typeof i&&"string"==typeof l?Z.getInstance().messageListByID(e.isOpenChannel(),e.url,n,s,r,t,a,i,l,function(n,t){if(t)S(null,t,o);else{var s=n.messages,r=[];for(var a in s){var i=L.build(s[a],e);i&&r.push(i)}S(r,null,o)}}):S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),o)};this.getNextMessagesByTimestamp=function(e,t,s,r,a,i,l){return n(this,e,t,0,s,r,a,i,l)},this.getPreviousMessagesByTimestamp=function(e,t,s,r,a,i,l){return n(this,e,t,s,0,r,a,i,l)},this.getPreviousAndNextMessagesByTimestamp=function(e,t,s,r,a,i,l){return n(this,e,!0,t,s,r,a,i,l)},this.getNextMessagesByID=function(e,n,s,r,a,i,l){return t(this,e,n,0,s,r,a,i,l)},this.getPreviousMessagesByID=function(e,n,s,r,a,i,l){return t(this,e,n,s,0,r,a,i,l)},this.getPreviousAndNextMessagesByID=function(e,n,s,r,a,i,l){return t(this,e,!0,n,s,r,a,i,l)},this._sendFileCommand=function(e,n,t,s,r,a,i,l,o,c,u,d){var h,I=this;h=d?d.reqId:Y.generateRequestId();var _=Y.bFile(h,e,n,t,s,r,a,i,l,o,c),E=M.build(_.requestId,0,se.getInstance().currentUser,this,"string"==typeof n?n:"",t,s,r,a,i,null,null,!1,null,null,c),f=new M(E);return"string"==typeof n&&se.getInstance().sendCommand(_,function(e,n){if(n)S(null,new p(n.message,n.code),u);else{var t=new M(e.getJsonElement()),s=se.getInstance().currentUser;s&&t._sender&&s.userId===t._sender.userId&&(s.nickname!==t._sender.nickname&&(s.nickname=t._sender.nickname),s.profileUrl!==t._sender.profileUrl&&(s.profileUrl=t._sender.profileUrl)),I.isGroupChannel()&&!I.isEphemeral&&H.getChannel(I.url,function(e,n){if(v){var s=e;e=n,n=s}if(n)S(null,n,u);else{e.lastMessage=t;for(var r in se.getInstance().channelHandlers){se.getInstance().channelHandlers[r].onChannelChanged(e)}}}),S(t,null,u)}}),f},this._getSendFileMessageParamInfo=function(e){var n={file:null,name:null,type:null,size:null,data:"",customType:"",thumbnailSizes:[],callback:null,progressHandler:null,mentionedUserIds:[]};switch("function"==typeof e.slice(-1)[0]&&(n.callback=e.pop()),"function"==typeof e.slice(-1)[0]&&(n.progressHandler=e.pop()),e.length){case 1:if(e[0]instanceof te){var t=e[0];n.file=t.file?t.file:t.fileUrl,n.name=t.fileName,n.type=t.mimeType,n.size=t.fileSize,n.data=t.data,n.customType=t.customType,n.thumbnailSizes=t.thumbnailSizes,n.mentionedUserIds=t._mentionedIds}else n.file=e[0];break;case 2:n.file=e[0],n.data=e[1];break;case 3:n.file=e[0],n.data=e[1],n.customType=e[2];break;case 4:n.file=e[0],n.data=e[1],n.customType=e[2],n.thumbnailSizes=e[3];break;case 5:n.file=e[0],n.name=e[1],n.type=e[2],n.size=e[3],n.data=e[4];break;case 6:n.file=e[0],n.name=e[1],n.type=e[2],n.size=e[3],n.data=e[4],n.customType=e[5];break;case 7:n.file=e[0],n.name=e[1],n.type=e[2],n.size=e[3],n.data=e[4],n.customType=e[5],n.thumbnailSizes=e[6]}return"string"!=typeof n.file&&null!==n.file&&(null!==n.name&&void 0!==n.name&&n.name||(n.name=n.file.name),null!==n.type&&void 0!==n.type&&n.type||(n.type=n.file.type),null!==n.size&&void 0!==n.size||(n.size=n.file.size)),null!==n.name&&void 0!==n.name||(n.name=""),null!==n.type&&void 0!==n.type||(n.type=""),null!==n.size&&void 0!==n.size||(n.size=0),n},this.sendFileMessage=function(){var e=this,n=this._getSendFileMessageParamInfo(Array.prototype.slice.call(arguments)),t=n.file,s=n.name,r=n.type,a=n.size,i=n.data,l=n.customType,o=n.thumbnailSizes,c=n.callback,u=n.progressHandler,d=n.mentionedUserIds;if(null!==o&&void 0!==o||(o=[]),se.getInstance().hasLoggedIn()){if(!(null===t||void 0===t||null!==s&&void 0!==s&&"string"!=typeof s||null!==r&&void 0!==r&&"string"!=typeof r||null!==a&&void 0!==a&&(!_(a)||parseInt(a)<0)||null!==i&&void 0!==i&&"string"!=typeof i||null!==l&&void 0!==l&&"string"!=typeof l)&&Array.isArray(o)){var h=e.url,I=null;return"string"==typeof t?I=e._sendFileCommand(h,t,s,r,a,i,l,[],!1,d,c):(I=e._sendFileCommand(h,t,s,r,a,i,l,[],!1,d,c),Z.getInstance().uploadFile(t,r,o,h,function(n,t){if(t)S(null,t,c);else{var o="object"==typeof n?n:JSON.parse(n),u=o.url,_=o.hasOwnProperty("thumbnails")?o.thumbnails:[],E=!!o.hasOwnProperty("require_auth")&&o.require_auth;e._sendFileCommand(h,u,s,r,a,i,l,_,E,d,c,I)}},u,this.fileUploadRequest,I.reqId)),I}S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),c)}else S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),c)},this.cancelUploadingFileMessage=function(e,n){if(se.getInstance().hasLoggedIn()){if(_(e)){var t=this,s=t.fileUploadRequest[e];return s?(s.upload.onabort=function(){delete t.fileUploadRequest[e],S(!0,null,n)},s.abort(),!0):(S(!1,new p("Uploading has been completed or cancelled.",J.FILE_UPLOAD_CANCEL_FAILED),n),!1)}S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n)}else S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n)},this.sendUserMessage=function(e,n,t,s,r){var a=this,i=[];if("function"==typeof n&&(r=n,n="",t="",s=[],e instanceof ne)){var l=e;e=l.message,n=l.data,t=l.customType,s=l.targetLanguages,i=l._mentionedIds}if("function"==typeof t&&(r=t,t="",s=[]),"function"==typeof s&&(r=s,s=[]),s||(s=[]),"string"==typeof s&&(s=[s]),null===n&&(n=""),null===t&&(t=""),se.getInstance().hasLoggedIn()){if("string"==typeof e&&"string"==typeof n&&"string"==typeof t&&Array.isArray(s)){var o=Y.bMessage(this.url,e,n,t,i,s),c=D.build(o.requestId,0,se.getInstance().currentUser,this,e,n,t,s,(new Date).getTime(),null,null,i),u=new D(c);return se.getInstance().sendCommand(o,function(e,n){if(n)S(null,new p(n.message,n.code),r);else{var t=new D(e.getJsonElement()),s=se.getInstance().currentUser;s&&t._sender&&s.userId===t._sender.userId&&(s.nickname!==t._sender.nickname&&(s.nickname=t._sender.nickname),s.profileUrl!==t._sender.profileUrl&&(s.profileUrl=t._sender.profileUrl)),a.isGroupChannel()&&!a.isEphemeral&&H.getChannel(a.url,function(e,n){if(v){var s=e;e=n,n=s}if(n)S(null,n,r);else{e.lastMessage=t;for(var a in se.getInstance().channelHandlers){se.getInstance().channelHandlers[a].onChannelChanged(e)}}}),S(t,null,r)}}),u}S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),r)}else S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),r)},this.updateUserMessage=function(e,n,t,s,r){var a=Array.prototype.slice.call(arguments);if(5!==a.length)return"function"==typeof a.slice(-1)[0]&&(r=a.pop()),void S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),r);if(se.getInstance().hasLoggedIn())if(_(e))if("string"!=typeof n&&null!==n&&void 0!==n||"string"!=typeof t&&null!==t&&void 0!==t||"string"!=typeof s&&null!==s&&void 0!==s)S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),r);else{var i=Y.bUpdateUserMessage(this.url,e,n,t,s);se.getInstance().sendCommand(i,function(e,n){if(n)S(null,new p(n.message,n.code),r);else{var t=new D(e.getJsonElement());S(t,null,r)}})}else S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),r);else S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),r)},this.updateFileMessage=function(e,n,t,s){var r=Array.prototype.slice.call(arguments);if(4!==r.length)return"function"==typeof r.slice(-1)[0]&&(s=r.pop()),void S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),s);if(se.getInstance().hasLoggedIn())if(_(e))if("string"!=typeof n&&null!==n&&void 0!==n||"string"!=typeof t&&null!==t&&void 0!==t)S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),s);else{var a=Y.bUpdateFileMessage(this.url,e,n,t);se.getInstance().sendCommand(a,function(e,n){if(n)S(null,new p(n.message,n.code),s);else{var t=new M(e.getJsonElement());S(t,null,s)}})}else S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),s);else S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),s)},this.createMetaCounters=function(e,n){se.getInstance().hasLoggedIn()?null==e||"object"!=typeof e||Array.isArray(e)||I(e)?S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n):Z.getInstance().createMetaCounters(this.isOpenChannel(),this.url,e,function(e,t){t?S(null,t,n):S(e,null,n)}):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n)},this.updateMetaCounters=function(e,n,t){se.getInstance().hasLoggedIn()?("function"!=typeof n&&void 0!==t||(t=n,n=!1),null==e||"object"!=typeof e||Array.isArray(e)||I(e)||"boolean"!=typeof n?S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),t):Z.getInstance().updateMetaCounters(this.isOpenChannel(),this.url,e,n,Z.UPDATE_META_COUNTER_MODE_SET,function(e,n){n?S(null,n,t):S(e,null,t)})):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),t)},this.increaseMetaCounters=function(e,n){se.getInstance().hasLoggedIn()?null==e||"object"!=typeof e||Array.isArray(e)||I(e)?S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n):Z.getInstance().updateMetaCounters(this.isOpenChannel(),this.url,e,!1,Z.UPDATE_META_COUNTER_MODE_INC,function(e,t){t?S(null,t,n):S(e,null,n)}):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n)},this.decreaseMetaCounters=function(e,n){se.getInstance().hasLoggedIn()?null==e||"object"!=typeof e||Array.isArray(e)||I(e)?S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n):Z.getInstance().updateMetaCounters(this.isOpenChannel(),this.url,e,!1,Z.UPDATE_META_COUNTER_MODE_DEC,function(e,t){if(t)S(null,t,n);else{var s=e,r={};for(var a in s){var i=s[a];r[a]=i}S(r,null,n)}}):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n)},this.getMetaCounters=function(e,n){se.getInstance().hasLoggedIn()?Array.isArray(e)?Z.getInstance().getMetaCounters(this.isOpenChannel(),this.url,e,function(e,t){t?S(null,t,n):S(e,null,n)}):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n)},this.getAllMetaCounters=function(e){se.getInstance().hasLoggedIn()?Z.getInstance().getAllMetaCounters(this.isOpenChannel(),this.url,function(n,t){t?S(null,t,e):S(n,null,e)}):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),e)},this.deleteMetaCounter=function(e,n){se.getInstance().hasLoggedIn()?"string"==typeof e?Z.getInstance().deleteMetaCounter(this.isOpenChannel(),this.url,e,function(e,t){t?S(null,t,n):S(e,null,n)}):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n)},this.deleteAllMetaCounters=function(e){se.getInstance().hasLoggedIn()?Z.getInstance().deleteAllMetaCounters(this.isOpenChannel(),this.url,function(n,t){t?e&&S(null,t,e):S(n,null,e)}):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),e)},this.createMetaData=function(e,n){se.getInstance().hasLoggedIn()?null==e||"object"!=typeof e||Array.isArray(e)||I(e)?S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n):Z.getInstance().createMetaData(this.isOpenChannel(),this.url,e,function(e,t){t?S(null,t,n):S(e,null,n)}):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n)},this.updateMetaData=function(e,n,t){se.getInstance().hasLoggedIn()?("function"!=typeof n&&void 0!==t||(t=n,n=!1),null==e||"object"!=typeof e||Array.isArray(e)||I(e)||"boolean"!=typeof n?S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),t):Z.getInstance().updateMetaData(this.isOpenChannel(),this.url,e,n,function(e,n){n?S(null,n,t):S(e,null,t)})):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),t)},this.getMetaData=function(e,n){se.getInstance().hasLoggedIn()?Array.isArray(e)?Z.getInstance().getMetaData(this.isOpenChannel(),this.url,e,function(e,t){t?S(null,t,n):S(e,null,n)}):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n)},this.getAllMetaData=function(e){se.getInstance().hasLoggedIn()?Z.getInstance().getAllMetaData(this.isOpenChannel(),this.url,function(n,t){t?S(null,t,e):S(n,null,e)}):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),e)},this.deleteMetaData=function(e,n){se.getInstance().hasLoggedIn()?"string"==typeof e?Z.getInstance().deleteMetaData(this.isOpenChannel(),this.url,e,function(e,t){t?S(null,t,n):S(e,null,n)}):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n)},this.deleteAllMetaData=function(e){se.getInstance().hasLoggedIn()?Z.getInstance().deleteAllMetaData(this.isOpenChannel(),this.url,function(n,t){t?e&&S(null,t,e):S(n,null,e)}):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),e)},this.deleteMessage=function(e,n){var t=Array.prototype.slice.call(arguments);if(2!==t.length)return"function"==typeof t.slice(-1)[0]&&(n=t.pop()),void S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n);if(se.getInstance().hasLoggedIn()){"object"!=typeof e||I(e)||Array.isArray(e)||Object.keys(e).indexOf("messageId")<0||!e?S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n):Z.getInstance().deleteMessage(this.isOpenChannel(),this.url,e.messageId,function(e,t){S(null,t||null,n)})}else S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n)},this.channelType=b.CHANNEL_TYPE_BASE,e&&this._update(e)};b.CHANNEL_TYPE_OPEN="open",b.CHANNEL_TYPE_GROUP="group",b.CHANNEL_TYPE_BASE="base";var w=function(e){this.parse=function(e){if(e.hasOwnProperty("participant_count")&&(this.participantCount=parseInt(e.participant_count)),e.hasOwnProperty("operators")&&e.operators){this.operators=[];for(var n in e.operators){var t=new G(e.operators[n]);this.operators.push(t)}}},this.refresh=function(e){w.getChannelWithoutCache(this.url,function(n,t){if(v){var s=n;n=t,t=s}t?S(null,t,e):S(n,null,e)})},this.update=function(e){this._update(e),this.parse(e)},this.delete=function(e){var n=this.url;Z.getInstance().deleteOpenChannel(n,function(t,s){s?S(null,s,e):(delete w.cachedChannels[n],S(t,null,e))})},this.enter=function(e){var n=this,t=Y.bEnter(n.url);se.getInstance().sendCommand(t,function(t,s){s?S(null,new p(s.message,s.code),e):(w.enteredChannels[n.url]=n,S(null,null,e))})},this.exit=function(e){var n=this,t=Y.bExit(n.url);se.getInstance().sendCommand(t,function(t,s){s?S(null,new p(s.message,s.code),e):(delete w.enteredChannels[n.url],S(null,null,e))})},this.createParticipantListQuery=function(){return new z(z.PARTICIPANT,this)},this.createMutedUserListQuery=function(){return new z(z.MUTED_USER,this)},this.createBannedUserListQuery=function(){return new z(z.BANNED_USER,this)},this.updateChannel=function(){var e=Array.prototype.slice.call(arguments),n=null,t=null,s=null,r=null,a=null,i=null;switch("function"==typeof e.slice(-1)[0]&&(i=e.pop()),e.length){case 3:n=e[0],t=e[1],s=e[2];break;case 4:n=e[0],t=e[1],s=e[2],r=e[3];break;case 5:n=e[0],t=e[1],s=e[2],r=e[3],a=e[4];break;default:return void S(null,new p("Invalid arguments.2",J.INVALID_PARAMETER),i)}this.updateChannelWithOperatorUserIds(n,t,s,r,a,i)},this.updateChannelWithOperatorUserIds=function(e,n,t,s,r,a){"function"==typeof r&&(a=r,r=null),"string"!=typeof e&&null!==e&&void 0!==e||"string"!=typeof n&&I(n)&&null!==n&&void 0!==n||"string"!=typeof t&&null!==t&&void 0!==t||"string"!=typeof s&&!Array.isArray(s)&&null!==s&&void 0!==s||"string"!=typeof r&&null!==r&&void 0!==r?S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),a):Z.getInstance().updateOpenChannel(this.url,e,n,t,s,r,function(e,n){if(n)S(null,n,a);else{var t=w.upsert(e);S(t,null,a)}})},this.banUser=function(e,n,t){"function"==typeof n&&3!==arguments.length&&(t=n,n=-1),!e||parseInt(n)<0&&-1!==parseInt(n)?S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),t):this.banUserWithUserId(e.userId,n,t)},this.banUserWithUserId=function(e,n,t){if("function"==typeof n&&3!==arguments.length&&(t=n,n=-1),!e||parseInt(n)<0&&-1!==parseInt(n))S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),t);else{Z.getInstance().banUser(this.url,e,null,n,!1,function(e,n){S(null,n||null,t)})}},this.unbanUser=function(e,n){e?this.unbanUserWithUserId(e.userId,n):S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.unbanUserWithUserId=function(e,n){if(e){Z.getInstance().unbanUser(this.url,e,!1,function(e,t){S(null,t||null,n)})}else S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.muteUser=function(e,n){e?this.muteUserWithUserId(e.userId,n):S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.muteUserWithUserId=function(e,n){if(e){Z.getInstance().muteUser(this.url,e,!1,function(e,t){S(null,t||null,n)})}else S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.unmuteUser=function(e,n){e?this.unmuteUserWithUserId(e.userId,n):S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.unmuteUserWithUserId=function(e,n){if(e){Z.getInstance().unmuteUser(this.url,e,!1,function(e,t){S(null,t||null,n)})}else S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.isOperator=function(e){return!!e&&this.isOperatorWithUserId(e.userId)},this.isOperatorWithUserId=function(e){for(var n in this.operators)if(this.operators[n].userId===e)return!0;return!1},this.channelType=b.CHANNEL_TYPE_OPEN,this.participantCount=0,this.operators=[],e&&(this._update(e),this.parse(e))};E(b,w),w.enteredChannels={},w.clearEnteredChannels=function(){w.enteredChannels={}},w.createOpenChannelListQuery=function(){return new K},w.buildFromSerializedData=function(e){var n=m(e);return new w({channel_url:n.url,name:n.name,cover_url:n.coverUrl,data:n.data,custom_type:n.customType,created_at:n.createdAt/1e3,freeze:n.isFrozen,is_ephemeral:n.isEphemeral,participant_count:n.participantCount,operators:n.operators.map(function(e){return G.build(e.userId,e.nickname,e.profileUrl,e.connectionStatus,e.lastSeenAt,e.metaData,e.isActive,e.friendDiscoveryKey,e.friendName)})})},w.createChannel=function(){var e,n,t,s,r,a;switch(arguments.length){case 1:a=arguments[0];break;case 4:e=arguments[0],n=arguments[1],t=arguments[2],a=arguments[3];break;case 5:e=arguments[0],n=arguments[1],t=arguments[2],s=arguments[3],a=arguments[4];break;case 6:e=arguments[0],n=arguments[1],t=arguments[2],s=arguments[3],r=arguments[4],a=arguments[5]}w.createChannelWithOperatorUserIds(e,n,t,s,r,a)},w.upsert=function(e){var n=new w(e);return w.cachedChannels.hasOwnProperty(n.url)?w.cachedChannels[n.url].update(e):w.cachedChannels[n.url]=n,w.cachedChannels[n.url]},w.createChannelWithOperatorUserIds=function(e,n,t,s,r,a){"function"==typeof r&&(a=r,r=""),"string"!=typeof e&&null!==e&&void 0!==e||"string"!=typeof n&&I(n)&&null!==n&&void 0!==n||"string"!=typeof t&&null!==t&&void 0!==t||"string"!=typeof s&&!Array.isArray(s)&&null!==s&&void 0!==s||"string"!=typeof r&&null!==r&&void 0!==r?S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),a):Z.getInstance().createOpenChannel(e,n,t,s,r,function(e,n){if(n)S(null,n,a);else{var t=w.upsert(e);S(t,null,a)}})},w.cachedChannels={},w.clearCache=function(){w.cachedChannels={}},w.removeCachedChannel=function(e){delete w.cachedChannels[e]},w.getChannel=function(e,n){e?w.cachedChannels.hasOwnProperty(e)?S(w.cachedChannels[e],null,n):w.getChannelWithoutCache(e,n):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n)},w.getChannelWithoutCache=function(e,n){e?Z.getInstance().getOpenChannel(e,function(t,s){s?S(null,s,n):(w.upsert(t),S(w.cachedChannels[e],null,n))}):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n)};var H=function(n){var t,s,r={};this.parse=function(e){var n=this;if(n.isDistinct=!!e.is_distinct,n.unreadMessageCount=parseInt(e.unread_message_count),n.isPushEnabled=!!e.is_push_enabled,n.isHidden=!!e.hasOwnProperty("is_hidden")&&e.is_hidden,e.hasOwnProperty("read_receipt")){n.cachedReadReceiptStatus={};for(var t in e.read_receipt){var s=e.read_receipt[t];n.updateReadReceipt(t,parseInt(s))}}e.hasOwnProperty("members")&&(n.members=[],n.memberMap={},e.members.forEach(function(e){var t=new V(e);n.members.push(t),n.memberMap[t.userId]=t}));e.hasOwnProperty("member_state")?n.myMemberState=e.member_state:n.myMemberState="none",e.hasOwnProperty("member_count")&&(n.memberCount=parseInt(e.member_count)),e.hasOwnProperty("last_message")&&"object"==typeof e.last_message&&e.last_message?e.last_message instanceof L?n.lastMessage=e.last_message:n.lastMessage=L.build(e.last_message,n):n.lastMessage=null,e.hasOwnProperty("inviter")&&null!==e.inviter&&"object"==typeof e.inviter&&!I(e.inviter)?n.inviter=new G(e.inviter):n.inviter=null,e.hasOwnProperty("is_super")&&null!==e.is_super&&"boolean"==typeof e.is_super?n.isSuper=e.is_super:n.isSuper=!1,e.hasOwnProperty("is_public")&&null!==e.is_public&&"boolean"==typeof e.is_public?n.isPublic=e.is_public:n.isPublic=!1},this.refresh=function(e){H.getChannelWithoutCache(this.url,function(n,t){if(v){var s=n;n=t,t=s}t?S(null,t,e):S(n,null,e)})},this.update=function(e){this._update(e),this.parse(e)},this.updateChannel=function(){var e=Array.prototype.slice.call(arguments),n=null,t=null,s=null,r=null,a=null,i=null,l=null;switch("function"==typeof e.slice(-1)[0]&&(i=e.pop()),e.length){case 1:if(!(e[0]instanceof ee))return void S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),i);var o=e[0];n=o.isDistinct,t=o.name,s=o.channelCover,r=o.data,a=o.customType,l=o.isPublic;break;case 3:n=this.isDistinct,t=e[0],s=e[1],r=e[2];break;case 4:n=e[0],t=e[1],s=e[2],r=e[3];break;case 5:n=e[0],t=e[1],s=e[2],r=e[3],a=e[4];break;default:return void S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),i)}"string"!=typeof t&&null!==t&&void 0!==t||"string"!=typeof s&&I(s)&&null!==s&&void 0!==s||"string"!=typeof r&&null!==r&&void 0!==r||"boolean"!=typeof n&&null!==n||"boolean"!=typeof l&&null!==l||"string"!=typeof a&&null!==a&&void 0!==a?S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),i):Z.getInstance().updateGroupChannel(this.url,n,t,s,r,a,l,function(e,n){if(n)S(null,n,i);else{var t=H.upsert(e);S(t,null,i)}})},this.resetMyHistory=function(e){se.getInstance().hasLoggedIn()?Z.getInstance().resetMyHistory(this.url,function(n,t){t?S(null,t,e):S(n,null,e)}):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),e)},this.invite=function(e,n){if("string"==typeof e&&(e=[{userId:e}]),Array.isArray(e)&&!I(e)){var t=[];for(var s in e){if("object"!=typeof e[s]||I(e[s])){S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n);break}t.push(e[s].userId)}this.inviteWithUserIds(t,n)}else S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n)},this.inviteWithUserIds=function(e,n){Array.isArray(e)&&!I(e)?Z.getInstance().groupChannelInvite(this.url,e,function(e,t){if(t)S(null,t,n);else{var s=H.upsert(e);S(s,null,n)}}):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n)},this.acceptInvitation=function(e){Z.getInstance().acceptInvitation(this.url,se.getInstance().getCurrentUserId(),function(n,t){if(t)S(null,t,e);else{var s=H.upsert(n);s.myMemberState="joined",H.cachedChannels[s.url]=s,S(s,null,e)}})},this.declineInvitation=function(e){var n=this;Z.getInstance().declineInvitation(this.url,se.getInstance().getCurrentUserId(),function(t,s){s?S(null,s,e):(n.myMemberState="none",H.cachedChannels[n.url]=n,n.isPublic||H.removeCachedChannel(n.url),S(t,null,e))})},this.hide=function(e,n){if(1===arguments.length&&"function"==typeof e&&(n=e,e=!1),null!==e&&void 0!==e||(e=!1),"boolean"==typeof e){var t=this.url,s=this;Z.getInstance().groupChannelHide(t,se.getInstance().getCurrentUserId(),e,function(r,a){if(a)S(null,a,n);else{s.isHidden=!0;var i=H.cachedChannels[t];i&&(i.isHidden=!0,e&&(i.unreadMessageCount=0),H.cachedChannels[t]=i),S(r,null,n)}})}else S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.join=function(e){var n=this.url;Z.getInstance().publicGroupChannelJoin(n,se.getInstance().getCurrentUserId(),function(n,t){if(t)S(null,t,e);else{var s=H.upsert(n);s.myMemberState="joined",H.cachedChannels[s.url]=s,S(s,null,e)}})},this.leave=function(e){var n=this.url;Z.getInstance().groupChannelLeave(n,se.getInstance().getCurrentUserId(),function(n,t){S(null,t||null,e)})},this.markAsRead=function(){this._sendMarkAsRead(null)},this._sendMarkAsRead=function(e){var n=this,t=Y.bRead(n.url);se.getInstance().sendCommand(t,function(t,s){if(s)S(null,new p(s.message,s.code),e);else{if(n.unreadMessageCount>0){n.unreadMessageCount=0;for(var r in se.getInstance().channelHandlers){se.getInstance().channelHandlers[r].onChannelChanged(n)}}S(null,null,e)}})},this.getReadReceipt=function(n){if(!(n instanceof L))return e.log("message is not BaseMessage instance"),-1;if(n.messageType===L.MESSAGE_TYPE_ADMIN)return 0;var t=se.getInstance().currentUser,s=0,r=n.createdAt,a=this.members;for(var i in a){var l=a[i].userId;if(!(t.userId===l||n.sender&&n.sender.userId===l))this.cachedReadReceiptStatus[l]<r&&s++}return this.isSuper?0:s},this.getReadStatus=function(){var e={};if(!se.getInstance().currentUser)return e;var n=this.members;for(var t in n){var s=n[t],r=s.userId;if(s.userId!==se.getInstance().getCurrentUserId()){var a=this.cachedReadReceiptStatus[r];e[r]={user:s,last_seen_at:parseInt(a)}}}return e},this.updateReadReceipt=function(e,n){var t=e,s=this.cachedReadReceiptStatus[t],r=n;(!s||s<r)&&(this.cachedReadReceiptStatus[t]=r)},this.startTyping=function(){var e=(new Date).getTime();if(!(e-t<1e3)){s=0,t=e;var n=Y.bTypeStart(this.url,t);se.getInstance().sendCommand(n,null)}},this.endTyping=function(){var e=(new Date).getTime();if(!(e-s<1e3)){t=0,s=e;var n=Y.bTypeEnd(this.url,s);se.getInstance().sendCommand(n,null)}},this.invalidateTypingStatus=function(){var e=!1,n=(new Date).getTime();for(var t in r){n-r[t]>=1e4&&(delete r[t],e=!0)}return e},this.updateTypingStatus=function(e,n){n?r[e.userId]=(new Date).getTime():delete r[e.userId]},this.isTyping=function(){return 0!==Object.keys(r).length},this.getTypingMembers=function(){var e=[];for(var n in r){var t=this.memberMap[n];this.memberMap[n]&&e.push(t)}return e},this.addMember=function(e){var n=this.removeMember(e);n&&n.state===V.JOINED&&(e.state=V.JOINED),this.memberMap[e.userId]=e,this.members.push(e),this.memberCount++,this.updateReadReceipt(e.userId,0)},this.removeMember=function(e){var n=e.userId,t=null;if(this.memberMap.hasOwnProperty(e.userId)){delete this.memberMap[e.userId];for(var s in this.members){var r=this.members[s];if(r.userId===n){t=r,this.members.splice(s,1);break}}this.memberCount--}return null===t&&this.isSuper&&this.memberCount--,t},this.setPushPreference=function(e,n){var t=this;se.getInstance().hasLoggedIn()?Z.getInstance().setPushPreference(se.getInstance().getCurrentUserId(),this.url,e,function(e,s){s?S(null,s,n):(t.isPushEnabled=e.enable,S(e,null,n))}):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n)},this.getPushPreference=function(e){var n=this;se.getInstance().hasLoggedIn()?Z.getInstance().getPushPreference(se.getInstance().getCurrentUserId(),this.url,function(t,s){if(s)S(null,s,e);else if(e){var r;try{r=t.enable}catch(e){r=!1}n.isPushEnabled=r,S(r,null,e)}}):S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),e)},this.createMemberListQuery=function(){var e=this.url;return new B(e)},this.banUser=function(e,n,t,s){e&&e.hasOwnProperty("userId")&&"string"==typeof t?this.banUserWithUserId(e.userId,n,t,s):S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),s)},this.banUserWithUserId=function(e,n,t,s){if(e&&"string"==typeof e&&"string"==typeof t){Z.getInstance().banUser(this.url,e,t,n,!0,function(e,n){S(null,n||null,s)})}else S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),s)},this.unbanUser=function(e,n){e&&e.hasOwnProperty("userId")?this.unbanUserWithUserId(e.userId,n):S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.unbanUserWithUserId=function(e,n){if(e&&"string"==typeof e){Z.getInstance().unbanUser(this.url,e,!0,function(e,t){S(null,t||null,n)})}else S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.muteUser=function(e,n){e&&e.hasOwnProperty("userId")?this.muteUserWithUserId(e.userId,n):S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.muteUserWithUserId=function(e,n){if(e&&"string"==typeof e){Z.getInstance().muteUser(this.url,e,!0,function(e,t){S(null,t||null,n)})}else S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.unmuteUser=function(e,n){e&&e.hasOwnProperty("userId")?this.unmuteUserWithUserId(e.userId,n):S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.unmuteUserWithUserId=function(e,n){if(e&&"string"==typeof e){Z.getInstance().unmuteUser(this.url,e,!0,function(e,t){S(null,t||null,n)})}else S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.freeze=function(e){Z.getInstance().freeze(this.url,!0,!0,function(n,t){if(t)S(null,t,e);else{H.upsert(n);S(null,null,e)}})},this.unfreeze=function(e){Z.getInstance().freeze(this.url,!0,!1,function(n,t){if(t)S(null,t,e);else{H.upsert(n);S(null,null,e)}})},this.createBannedUserListQuery=function(){return new z(z.BANNED_USER,this)},this.channelType=b.CHANNEL_TYPE_GROUP,this.isDistinct=!1,this.isSuper=!1,this.isPublic=!1,this.unreadMessageCount=0,this.inviter=null,this.members=[],this.memberMap={},this.lastMessage={},this.memberCount=0,this.cachedReadReceiptStatus={},this.isPushEnabled,this.isHidden=!1,n&&(this._update(n),this.parse(n))};E(b,H),H.buildFromSerializedData=function(e){var n,t=m(e);return new H({channel_url:t.url,name:t.name,cover_url:t.coverUrl,data:t.data,custom_type:t.customType,created_at:t.createdAt/1e3,is_distinct:t.isDistinct,is_super:t.isSuper,is_public:t.isPublic,freeze:t.isFrozen,is_ephemeral:t.isEphemeral,unread_message_count:t.unreadMessageCount,is_push_enabled:t.isPushEnabled,is_hidden:t.isHidden,member_count:t.memberCount,member_state:t.myMemberState,members:t.members.map(function(e){return V.build(G.build(e.userId,e.nickname,e.profileUrl,e.connectionStatus,e.lastSeenAt,e.metaData,e.isActive,e.friendDiscoveryKey,e.friendName),e.state,e.isBlockedByMe,e.isBlockingMe)}),last_message:(n=t.lastMessage,null!==n&&void 0!==n&&"object"==typeof n?n.messageType===L.MESSAGE_TYPE_USER?new D(D.build(n.reqId,n.messageId,n.sender,{url:n.channelUrl,channelType:n.channelType},n.message,n.data,n.customType,n.translations,n.createdAt,n.updatedAt)):n.messageType===L.MESSAGE_TYPE_FILE?new M(M.build(n.reqId,n.messageId,n.sender,{url:n.channelUrl,channelType:n.channelType},n.url,n.name,n.type,n.size,n.data,n.customType,n.createdAt,n.thumbnails,n.requireAuth,n.updatedAt)):new O(O.build(n.messageId,{url:n.channelUrl,channelType:n.channelType},n.message,n.data,n.customType,n.translations,n.createdAt,n.updatedAt)):null),read_receipt:t.cachedReadReceiptStatus,inviter:null!==t.inviter&&void 0!==t.inviter&&"object"==typeof t.inviter?G.build(t.inviter.userId,t.inviter.nickname,t.inviter.profileUrl,t.inviter.connectionStatus,t.inviter.lastSeenAt,t.inviter.metaData,t.inviter.isActive,t.inviter.friendDiscoveryKey,t.inviter.friendName):null})},H.createMyGroupChannelListQuery=function(){return new Q(se.getInstance().currentUser)},H.createPublicGroupChannelListQuery=function(){return new W},H.memberState={ALL:0,JOINED:1,INVITED:2,INVITED_BY_FRIEND:3,INVITED_BY_NON_FRIEND:4},H.memberStateFilter={ALL:"all",JOINED:"joined_only",INVITED:"invited_only",INVITED_BY_FRIEND:"invited_by_friend",INVITED_BY_NON_FRIEND:"invited_by_non_friend"},H.superChannelFilter={ALL:"all",SUPER:"super",NON_SUPER:"nonsuper"},H.publicChannelFilter={ALL:"all",PUBLIC:"public",PRIVATE:"private"},H.getChannelCount=function(e,n){"function"==typeof e&&1===arguments.length&&(n=e,e=H.memberState.ALL),e===H.memberState.ALL||e===H.memberState.JOINED||e===H.memberState.INVITED||e===H.memberState.INVITED_BY_FRIEND||e===H.memberState.INVITED_BY_NON_FRIEND?se.getInstance().hasLoggedIn()?Z.getInstance().getGroupChannelCount(se.getInstance().getCurrentUserId(),e,function(e,t){if(t)S(null,t,n);else{var s=parseInt(e.group_channel_count);S(s,null,n)}}):n&&S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n)},H.getTotalUnreadMessageCount=function(e){Z.getInstance().getTotalUnreadMessageCount(se.getInstance().getCurrentUserId(),function(n,t){if(t)S(null,t,e);else{var s=parseInt(n.unread_count);S(s,null,e)}})},H.getTotalUnreadChannelCount=function(e){Z.getInstance().getTotalUnreadChannelCount(se.getInstance().getCurrentUserId(),function(n,t){if(t)S(null,t,e);else{var s=parseInt(n.unread_count);S(s,null,e)}})},H.createChannel=function(){var e=null,n=[],t=null,s=null,r=null,a=null,i=null,l=null,o=null,c={isPublic:null,channelUrl:null},u=[],d=null;switch(arguments.length){case 2:if(arguments[0]instanceof ee){var h=arguments[0];n=h._inviteUserIds,e=[],t=h.isDistinct,s=h.isSuper,r=h.name,a=h.channelCover,i=h.data,o=h.customType,u=h._operatorIds,c.isPublic=h.isPublic,c.channelUrl=h.channelUrl,d=h.isEphemeral,l=arguments[1];break}e=arguments[0],t=!1,l=arguments[1];break;case 3:e=arguments[0],t=arguments[1],l=arguments[2];break;case 4:e=arguments[0],t=arguments[1],o=arguments[2],l=arguments[3];break;case 6:e=arguments[0],t=arguments[1],r=arguments[2],a=arguments[3],i=arguments[4],l=arguments[5];break;case 7:e=arguments[0],t=arguments[1],r=arguments[2],a=arguments[3],i=arguments[4],o=arguments[5],l=arguments[6]}!Array.isArray(e)||"boolean"!=typeof t&&null!==t||"boolean"!=typeof s&&null!==s||"boolean"!=typeof d&&null!==d||"boolean"!=typeof c.isPublic&&null!==c.isPublic||"string"!=typeof c.channelUrl&&null!==c.channelUrl||"string"!=typeof r&&null!==r&&void 0!==r||"string"!=typeof a&&I(a)&&null!==a&&void 0!==a||"string"!=typeof i&&null!==i&&void 0!==i||"string"!=typeof o&&null!==o&&void 0!==o?S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),l):(e.forEach(function(e){n.push(e.userId)}),H.createChannelWithUserIds(n,t,r,a,i,o,s,c,u,d,l))},H.createChannelWithUserIds=function(){var e=null,n=null,t=null,s=null,r=null,a=null,i=null,l=null,o=[],c={isPublic:null,channelUrl:null},u=null;switch(arguments.length){case 2:e=arguments[0],n=!1,a=arguments[1];break;case 3:e=arguments[0],n=arguments[1],a=arguments[2];break;case 4:e=arguments[0],n=arguments[1],i=arguments[2],a=arguments[3];break;case 6:e=arguments[0],n=arguments[1],t=arguments[2],s=arguments[3],r=arguments[4],a=arguments[5];break;case 7:e=arguments[0],n=arguments[1],t=arguments[2],s=arguments[3],r=arguments[4],i=arguments[5],a=arguments[6];break;case 8:e=arguments[0],n=arguments[1],t=arguments[2],s=arguments[3],r=arguments[4],i=arguments[5],l=arguments[6],a=arguments[7];break;case 9:e=arguments[0],n=arguments[1],t=arguments[2],s=arguments[3],r=arguments[4],i=arguments[5],l=arguments[6],c.isPublic=arguments[7].isPublic,c.channelUrl=arguments[7].channelUrl,a=arguments[8];break;case 10:e=arguments[0],n=arguments[1],t=arguments[2],s=arguments[3],r=arguments[4],i=arguments[5],l=arguments[6],c.isPublic=arguments[7].isPublic,c.channelUrl=arguments[7].channelUrl,o=arguments[8],a=arguments[9];break;case 11:e=arguments[0],n=arguments[1],t=arguments[2],s=arguments[3],r=arguments[4],i=arguments[5],l=arguments[6],c.isPublic=arguments[7].isPublic,c.channelUrl=arguments[7].channelUrl,o=arguments[8],u=arguments[9],a=arguments[10]}if(se.getInstance().hasLoggedIn())if(!Array.isArray(e)||"boolean"!=typeof n&&null!==n||"boolean"!=typeof l&&null!==l||"boolean"!=typeof u&&null!==u||"boolean"!=typeof c.isPublic&&null!==c.isPublic||"string"!=typeof c.channelUrl&&null!==c.channelUrl||"string"!=typeof t&&null!==t&&void 0!==t||"string"!=typeof s&&I(s)&&null!==s&&void 0!==s||"string"!=typeof r&&null!==r&&void 0!==r||"string"!=typeof i&&null!==i&&void 0!==i)S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),a);else{var d=e.filter(function(e,n,t){return n===t.indexOf(e)}),h=se.getInstance().currentUser;d.push(h.userId),Z.getInstance().createGroupChannel(d,n,t,s,r,i,l,c,o,u,function(e,n){if(n)S(null,n,a);else{var t=new H(e);H.cachedChannels[t.url]=t,S(t,null,a)}})}else S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),a)},H.cachedChannels={},H.clearCache=function(){H.cachedChannels={}},H.removeCachedChannel=function(e){delete H.cachedChannels[e]},H.upsert=function(e){var n=new H(e);return H.cachedChannels.hasOwnProperty(n.url)?H.cachedChannels[n.url].update(e):H.cachedChannels[n.url]=n,H.cachedChannels[n.url]},H.getChannelWithoutCache=function(e,n){e?Z.getInstance().getGroupChannel(e,!0,!0,function(e,t){if(t)S(null,t,n);else{var s=H.upsert(e);S(s,null,n)}}):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n)},H.getChannel=function(e,n){e?H.cachedChannels.hasOwnProperty(e)?S(H.cachedChannels[e],null,n):H.getChannelWithoutCache(e,n):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n)},H.markAsReadAllLastSentAt,H.markAsReadAll=function(e){se.getInstance().markAsReadAll(e)};var k=function(e){e&&(this.category=e.hasOwnProperty("cat")?parseInt(e.cat):0,this.data=e.hasOwnProperty("data")?e.data:null,this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):b.CHANNEL_TYPE_GROUP),this.isGroupChannel=function(){return this.channelType===b.CHANNEL_TYPE_GROUP},this.isOpenChannel=function(){return this.channelType===b.CHANNEL_TYPE_OPEN}};k.CATEGORY_NONE=0,k.CATEGORY_CHANNEL_ENTER=10102,k.CATEGORY_CHANNEL_EXIT=10103,k.CATEGORY_USER_CHANNEL_MUTE=10201,k.CATEGORY_USER_CHANNEL_UNMUTE=10200,k.CATEGORY_USER_CHANNEL_BAN=10601,k.CATEGORY_USER_CHANNEL_UNBAN=10600,k.CATEGORY_CHANNEL_FREEZE=10701,k.CATEGORY_CHANNEL_UNFREEZE=10700,k.CATEGORY_TYPING_START=10900,k.CATEGORY_TYPING_END=10901,k.CATEGORY_CHANNEL_JOIN=1e4,k.CATEGORY_CHANNEL_LEAVE=10001,k.CATEGORY_CHANNEL_INVITE=10020,k.CATEGORY_CHANNEL_DECLINE_INVITE=10022,k.CATEGORY_CHANNEL_PROP_CHANGED=11e3,k.CATEGORY_CHANNEL_DELETED=12e3,k.CATEGORY_CHANNEL_META_DATA_CHANGED=11100,k.CATEGORY_CHANNEL_META_COUNTERS_CHANGED=11200,k.CATEGORY_CHANNEL_HIDE=13e3;var F=function(e){e&&(this.category=e.hasOwnProperty("cat")?parseInt(e.cat):0)};F.CATEGORY_USER_BLOCK=20001,F.CATEGORY_USER_UNBLOCK=2e4,F.CATEGORY_FRIEND_DISCOVERED=20900;var G=function(e){this.nickname="",this.profileUrl="",this.userId="",this.connectionStatus="",this.lastSeenAt=null,this.metaData={},this.isActive=!0,this.friendDiscoveryKey=null,this.friendName=null,this.getOriginalProfileUrl=function(){var e="";if(((e=(e=this.profileUrl.indexOf("://")>-1?this.profileUrl.split("/")[2]:this.profileUrl.split("/")[0]).split("?")[0]).indexOf("sendbird.com")>-1||e.indexOf("intoz.com")>-1)&&this.profileUrl.indexOf(e+"/profile_images/")>-1){var n=this.profileUrl.replace("profile_images/","");return n===this.profileUrl?"":n}return""},this._update=function(e){e.hasOwnProperty("guest_id")&&(this.userId=String(e.guest_id)),e.hasOwnProperty("user_id")&&(this.userId=String(e.user_id)),e.hasOwnProperty("name")&&(this.nickname=String(e.name)),e.hasOwnProperty("nickname")&&(this.nickname=String(e.nickname)),e.hasOwnProperty("image")&&(this.profileUrl=String(e.image)),e.hasOwnProperty("profile_url")&&(this.profileUrl=String(e.profile_url)),e.hasOwnProperty("is_online")?e.is_online===G.NON_AVAILABLE?this.connectionStatus=G.NON_AVAILABLE:this.connectionStatus=e.is_online?G.ONLINE:G.OFFLINE:this.connectionStatus=G.NON_AVAILABLE,e.hasOwnProperty("last_seen_at")?this.lastSeenAt=parseInt(e.last_seen_at):this.lastSeenAt=0,e.hasOwnProperty("metadata")?this.metaData=e.metadata:this.metaData={},e.hasOwnProperty("is_active")?this.isActive=void 0===e.is_active||e.is_active:this.isActive=!0,e.hasOwnProperty("friend_discovery_key")?this.friendDiscoveryKey=e.friend_discovery_key:this.friendDiscoveryKey=null,e.hasOwnProperty("friend_name")?this.friendName=e.friend_name:this.friendName=null},this._updateMetaData=function(e,n){var t=this,s=Object.keys(e);n?s.forEach(function(e){delete t.metaData[e]}):s.forEach(function(n){t.metaData[n]=e[n]})},this.createMetaData=function(e,n){var t=this;"function"==typeof e&&1===arguments.length&&(n=e,e={}),"object"!=typeof e||I(e)||Array.isArray(e)?S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n):se.getInstance().hasLoggedIn()?Z.getInstance().createUserMetaData(t.userId,e,function(e,s){s?S(null,s,n):(t._updateMetaData(e),S(e,null,n))}):n&&S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n)},this.updateMetaData=function(e,n,t){var s=this;"function"==typeof e&&1===arguments.length&&(t=e,e={}),"function"==typeof n&&2===arguments.length&&(t=n,n=!1),"object"!=typeof e||I(e)||Array.isArray(e)||"boolean"!=typeof n?S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),t):se.getInstance().hasLoggedIn()?Z.getInstance().updateUserMetaData(s.userId,e,n,function(e,n){n?S(null,n,t):(s._updateMetaData(e),S(e,null,t))}):t&&S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),t)},this.deleteAllMetaData=function(e){var n=this,t=n.metaData;se.getInstance().hasLoggedIn()?Z.getInstance().deleteAllUserMetaData(n.userId,function(s,r){r?S(null,r,e):(n._updateMetaData(t,!0),S(s,null,e))}):e&&S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),e)},this.deleteMetaData=function(e,n){var t=this;if("function"==typeof e&&1===arguments.length&&(n=e,e=null),"string"==typeof e)if(se.getInstance().hasLoggedIn()){var s={};s[e]="",Z.getInstance().deleteUserMetaData(t.userId,e,function(e,r){r?S(null,r,n):(t._updateMetaData(s,!0),S(e,null,n))})}else n&&S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n);else S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.serialize=function(){var e=JSON.parse(JSON.stringify(this));return g(e)},e&&this._update(e)};G.NON_AVAILABLE="nonavailable",G.ONLINE="online",G.OFFLINE="offline",G.build=function(e,n,t,s,r,a,i,l,o){return{user_id:e,nickname:n,profile_url:t,is_online:s,last_seen_at:r,metadata:a,is_active:i,friend_discovery_key:l,friend_name:o}},G.buildFromSerializedData=function(e){var n=m(e);return new G(G.build(n.userId,n.nickname,n.profileUrl,n.connectionStatus,n.lastSeenAt,n.metaData,n.isActive,n.friendDiscoveryKey,n.friendName))};var V=function(e){this.state="",this.isBlockedByMe=!1,this.isBlockingMe=!1,this.parse=function(e){this.state=e.state,e.hasOwnProperty("is_blocked_by_me")&&(this.isBlockedByMe=e.is_blocked_by_me),e.hasOwnProperty("is_blocking_me")&&(this.isBlockingMe=e.is_blocking_me)},e&&(this._update(e),this.parse(e))};E(G,V),V.JOINED="joined",V.INVITED="invited",V.build=function(e,n,t,s){var r=e;return r.state=n,r.is_blocked_by_me=t,r.is_blocking_me=s,r},V.buildFromSerializedData=function(e){var n=m(e);return new V(V.build(G.build(n.userId,n.nickname,n.profileUrl,n.connectionStatus,n.lastSeenAt,n.metaData,n.isActive,n.friendDiscoveryKey,n.friendName),n.state,n.isBlockedByMe,n.isBlockingMe))};var Y=function(e,n,t){this.isAckRequired=function(){return"MESG"===this.command||"FILE"===this.command||"ENTR"===this.command||"EXIT"===this.command||"READ"===this.command||"MEDI"===this.command||"FEDI"===this.command},this.encode=function(){return this.command+this.payload+"\n"},this.decode=function(e){e=e.trim(),this.command=e.substring(0,4),this.payload=e.substring(4)},this.getJsonElement=function(){return JSON.parse(this.payload)},this.isRequestIdCommand=function(){return this.isAckRequired()||"EROR"===this.command},this.command,this.payload,this.requestId;var s,r=this;if(0!==arguments.length)switch(arguments.length){case 1:var a=arguments[0];if(!a||a.length<=4)return r.command="NOOP",void(r.payload="{}");if(a=a.trim(),r.command=a.substring(0,4),r.payload=a.substring(4),r.isRequestIdCommand()){var i=r.getJsonElement();i&&(r.requestId=i.hasOwnProperty("req_id")?i.req_id:"")}break;case 3:s=arguments[2];case 2:var l=arguments[0],o=arguments[1];s=s||"",r.command=l,r.requestId=s,r.requestId||r.isRequestIdCommand()&&(r.requestId=Y.generateRequestId()),o.req_id=r.requestId,r.payload=JSON.stringify(o)}};Y.bMessage=function(e,n,t,s,r,a){var i={};return i.channel_url=e,i.message=n,i.data=t,i.mentioned_user_ids=[],Array.isArray(r)&&r.length>0&&(i.mentioned_user_ids=r),s&&(i.custom_type=s),a.length>0&&(i.target_langs=a),new Y("MESG",i)},Y.bRead=function(e){var n={};return n.channel_url=e,new Y("READ",n)},Y.bTypeStart=function(e,n){var t={};return t.channel_url=e,t.time=n,new Y("TPST",t)},Y.bTypeEnd=function(e,n){var t={};return t.channel_url=e,t.time=n,new Y("TPEN",t)},Y.bFile=function(e,n,t,s,r,a,i,l,o,c,u){var d={};d.channel_url=n,d.url=t,d.name=s||"",d.type=r||"",d.size=a||0,d.custom=i,l&&(d.custom_type=l),o&&(d.thumbnails=o),c&&(d.require_auth=c),d.mentioned_user_ids=[];for(var h in u){var I=u[h];d.mentioned_user_ids.push(String(I))}return new Y("FILE",d,e)},Y.bPing=function(){var e={};return e.id=(new Date).getTime(),new Y("PING",e)},Y.bEnter=function(e){var n={};return n.channel_url=e,new Y("ENTR",n)},Y.bExit=function(e){var n={};return n.channel_url=e,new Y("EXIT",n)},Y.bUpdateUserMessage=function(e,n,t,s,r){var a={};return a.channel_url=e,a.msg_id=n,null!=t&&void 0!==t&&(a.message=t),null!=s&&void 0!==s&&(a.data=s),null!=r&&void 0!==r&&(a.custom_type=r),new Y("MEDI",a)},Y.bUpdateFileMessage=function(e,n,t,s){var r={};return r.channel_url=e,r.msg_id=n,null!=t&&void 0!==t&&(r.data=t),null!=s&&void 0!==s&&(r.custom_type=s),new Y("FEDI",r)},Y.requestIdSeed=(new Date).getTime(),Y.generateRequestId=function(){return Y.requestIdSeed++,String(Y.requestIdSeed)};var B=function(e){this.isLoading=!1,this.hasNext=!0,this.limit=20,this.mutedMemberFilter=B.MUTED_MEMBER_FILTER.ALL,this.operatorFilter=B.OPERATOR_FILTER.ALL;var n="",t=this;this.next=function(s){t.hasNext?t.isLoading?S(null,new p("Query in progress.",J.QUERY_IN_PROGRESS),s):"string"!=typeof t.mutedMemberFilter||[B.MUTED_MEMBER_FILTER.ALL,B.MUTED_MEMBER_FILTER.MUTED,B.MUTED_MEMBER_FILTER.UNMUTED].indexOf(t.mutedMemberFilter.toLowerCase())<0||"string"!=typeof t.operatorFilter||[B.OPERATOR_FILTER.ALL,B.OPERATOR_FILTER.OPERATOR,B.OPERATOR_FILTER.NONOPERATOR].indexOf(t.operatorFilter.toLowerCase())<0?S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),s):(t.isLoading=!0,Z.getInstance().loadGroupChannelMemberList(e,n,t.limit,t.mutedMemberFilter,t.operatorFilter,function(e,r){if(r)return t.isLoading=!1,void S(null,r,s);var a=e;(!(n=String(a.next))||n.length<=0)&&(t.hasNext=!1);var i=a.members.map(function(e){return new V(e)});t.isLoading=!1,S(i,null,s)})):S([],null,s)}};B.MUTED_MEMBER_FILTER={ALL:"all",MUTED:"muted",UNMUTED:"unmuted"},B.OPERATOR_FILTER={ALL:"all",OPERATOR:"operator",NONOPERATOR:"nonoperator"};var Q=function(e){this.isLoading=!1,this.hasNext=!0,this.limit=20,this.includeEmpty=!1,this.order=Q.ORDER_LATEST_LAST_MESSAGE,this.userIdsFilter=[],this.userIdsFilterExactMatch=!1,this.queryType="AND";var n={userIds:[],includeMode:!0,queryType:W.USER_IDS_INCLUDE_QUERY_TYPE.AND};this._userIdsExactFilter=[],this._userIdsIncludeFilter=[],this._userIdsIncludeFilterQueryType=W.USER_IDS_INCLUDE_QUERY_TYPE.AND,c?(this.userIdsExactFilter=this._userIdsExactFilter,this.userIdsIncludeFilter=this._userIdsIncludeFilter,this.userIdsIncludeFilterQueryType=this._userIdsIncludeFilterQueryType):(Object.defineProperty(this,"userIdsExactFilter",{get:function(){return this._userIdsExactFilter},set:function(e){if(!Array.isArray(e))throw new p("Invalid parameter.",J.INVALID_PARAMETER);this._userIdsExactFilter=e,this._userIdsIncludeFilter=[],n={userIds:this._userIdsExactFilter,includeMode:!1}}}),Object.defineProperty(this,"userIdsIncludeFilter",{get:function(){return this._userIdsIncludeFilter},set:function(e){if(!Array.isArray(e))throw new p("Invalid parameter.",J.INVALID_PARAMETER);this._userIdsIncludeFilter=e,this._userIdsExactFilter=[],n={userIds:this._userIdsIncludeFilter,includeMode:!0}}}),Object.defineProperty(this,"userIdsIncludeFilterQueryType",{get:function(){return this._userIdsIncludeFilterQueryType},set:function(e){this._userIdsIncludeFilterQueryType=e,n={queryType:this._userIdsIncludeFilterQueryType}}})),this.nicknameContainsFilter="",this.channelNameContainsFilter="",this.memberStateFilter=H.memberStateFilter.ALL,this.customTypeFilter="",this.customTypesFilter=[],this.channelUrlsFilter=[],this.superChannelFilter=H.superChannelFilter.ALL,this.publicChannelFilter=H.publicChannelFilter.ALL,this.customTypeStartsWithFilter=null;var t=e,s="",r=this;this.next=function(e){if(r.hasNext)if(r.isLoading)S(null,new p("Query in progress.",J.QUERY_IN_PROGRESS),e);else if(null!==r.nicknameContainsFilter&&void 0!==r.nicknameContainsFilter||(r.nicknameContainsFilter=""),null!==r.channelNameContainsFilter&&void 0!==r.channelNameContainsFilter||(r.channelNameContainsFilter=""),null===r.customTypeStartsWithFilter||"string"==typeof r.customTypeStartsWithFilter)if(!Array.isArray(r._userIdsExactFilter)||!Array.isArray(r._userIdsIncludeFilter)||"string"!=typeof r._userIdsIncludeFilterQueryType||[W.USER_IDS_INCLUDE_QUERY_TYPE.AND,W.USER_IDS_INCLUDE_QUERY_TYPE.OR].indexOf(r._userIdsIncludeFilterQueryType.toUpperCase())<0)S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),e);else{if("number"==typeof r.memberStateFilter){if(typeof r.memberStateFilter<0||typeof r.memberStateFilter>4)return void S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),e);r.memberStateFilter=["all","joined_only","invited_only","invited_by_friend","invited_by_non_friend"][r.memberStateFilter]}!_(r.limit)||!Array.isArray(r.userIdsFilter)||"boolean"!=typeof r.userIdsFilterExactMatch||"string"!=typeof r.customTypeFilter||!Array.isArray(r.customTypesFilter)||"string"!=typeof r.queryType||["AND","OR"].indexOf(r.queryType.toUpperCase())<0||"string"!=typeof r.order||[Q.ORDER_CHRONOLOGICAL,Q.ORDER_LATEST_LAST_MESSAGE,Q.CHANNEL_NAME_ALPHABETICAL].indexOf(r.order.toLowerCase())<0||"string"!=typeof r.memberStateFilter||[H.memberStateFilter.ALL,H.memberStateFilter.JOINED,H.memberStateFilter.INVITED,H.memberStateFilter.INVITED_BY_FRIEND,H.memberStateFilter.INVITED_BY_NON_FRIEND].indexOf(r.memberStateFilter.toLowerCase())<0||"string"!=typeof r.nicknameContainsFilter||"string"!=typeof r.channelNameContainsFilter||!Array.isArray(r.channelUrlsFilter)||"string"!=typeof r.superChannelFilter||[H.superChannelFilter.ALL,H.superChannelFilter.SUPER,H.superChannelFilter.NON_SUPER].indexOf(r.superChannelFilter.toLowerCase())<0||"string"!=typeof r.publicChannelFilter||[H.publicChannelFilter.ALL,H.publicChannelFilter.PUBLIC,H.publicChannelFilter.PRIVATE].indexOf(r.publicChannelFilter.toLowerCase())<0?S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),e):(Array.isArray(r.userIdsFilter)&&r.userIdsFilter.length>0&&(n={userIds:r.userIdsFilter,includeMode:!r.userIdsFilterExactMatch,queryType:r.queryType}),r.isLoading=!0,Z.getInstance().loadUserGroupChannelList(t.userId,s,r.limit,r.includeEmpty,r.order,n,r.nicknameContainsFilter,r.channelNameContainsFilter,r.channelUrlsFilter,r.customTypeFilter,r.customTypesFilter,r.customTypeStartsWithFilter,r.memberStateFilter,r.superChannelFilter,r.publicChannelFilter,function(n,t){if(t)return r.isLoading=!1,void S(null,t,e);var a=n;(!(s=String(a.next))||s.length<=0)&&(r.hasNext=!1);var i=a.channels,l=[];for(var o in i){var c=H.upsert(i[o]);l.push(c)}r.isLoading=!1,S(l,null,e)}))}else S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),e);else S([],null,e)}};Q.ORDER_LATEST_LAST_MESSAGE="latest_last_message",Q.ORDER_CHRONOLOGICAL="chronological",Q.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",Q.MEMBER_STATE_INVITED_ONLY="invited_only",Q.MEMBER_STATE_JOINED_ONLY="joined_only",Q.MEMBER_STATE_ALL="all";var W=function(){var e="";this.isLoading=!1,this.hasNext=!0,this.limit=20,this.includeEmpty=!0,this.order=W.ORDER_CHRONOLOGICAL,this.channelNameContainsFilter=null,this.channelUrlsFilter=[],this.customTypesFilter=[],this.customTypeStartsWithFilter=null,this.superChannelFilter=H.superChannelFilter.ALL,this.membershipFilter=W.MEMBERSHIP_TYPE.JOINED;var n=this;this.next=function(t){se.getInstance().hasLoggedIn()?n.hasNext?n.isLoading?S(null,new p("Query in progress.",J.QUERY_IN_PROGRESS),t):!_(n.limit)||"boolean"!=typeof n.includeEmpty||!Array.isArray(n.customTypesFilter)||!Array.isArray(n.channelUrlsFilter)||null!==n.channelNameContainsFilter&&"string"!=typeof n.channelNameContainsFilter||null!==n.customTypeStartsWithFilter&&"string"!=typeof n.customTypeStartsWithFilter||"string"!=typeof n.order||[W.ORDER_CHRONOLOGICAL,W.ORDER_LATEST_LAST_MESSAGE,W.CHANNEL_NAME_ALPHABETICAL].indexOf(n.order.toLowerCase())<0?S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),t):"string"!=typeof n.superChannelFilter||[H.superChannelFilter.ALL,H.superChannelFilter.SUPER,H.superChannelFilter.NON_SUPER].indexOf(n.superChannelFilter.toLowerCase())<0||"string"!=typeof n.membershipFilter||[W.MEMBERSHIP_TYPE.ALL,W.MEMBERSHIP_TYPE.JOINED].indexOf(n.membershipFilter.toLowerCase())<0?S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),t):(n.isLoading=!0,Z.getInstance().loadPublicGroupChannelList(e,n.limit,n.includeEmpty,n.order,n.channelNameContainsFilter,n.channelUrlsFilter,n.customTypesFilter,n.customTypeStartsWithFilter,n.superChannelFilter,n.membershipFilter,function(s,r){if(r)return n.isLoading=!1,void S(null,r,t);var a=s;(!(e=String(a.next))||e.length<=0)&&(n.hasNext=!1);var i=a.channels,l=[];for(var o in i){var c=H.upsert(i[o]);l.push(c)}n.isLoading=!1,S(l,null,t)})):S([],null,t):t&&S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),t)}};W.ORDER_CHRONOLOGICAL="chronological",W.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",W.USER_IDS_INCLUDE_QUERY_TYPE={AND:"AND",OR:"OR"},W.MEMBERSHIP_TYPE={ALL:"all",JOINED:"joined"};var x=function(e){this.isLoading=!1;var n=e,t=this;this.next=function(e,s,r,a){if(t.isLoading)S(null,new p("Query in progress.",J.QUERY_IN_PROGRESS),a);else if(4===arguments.length)_(e)&&_(s)&&"boolean"==typeof r?(t.isLoading=!0,Z.getInstance().messageList(n.isOpenChannel(),n.url,e,0,s,!1,r,"","",function(e,s){if(s)return t.isLoading=!1,void S(null,s,a);var r=e.messages,i=[];for(var l in r){var o=L.build(r[l],n);o&&i.push(o)}t.isLoading=!1,S(i,null,a)})):S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),a);else{if("function"!=typeof a){var i=Array.prototype.slice.call(arguments);"function"==typeof i.slice(-1)[0]&&(a=i.pop())}S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),a)}},this.prev=function(e,s,r,a){if(t.isLoading)S(null,new p("Query in progress.",J.QUERY_IN_PROGRESS),a);else if(4===arguments.length)_(e)&&_(s)&&"boolean"==typeof r?(t.isLoading=!0,Z.getInstance().messageList(n.isOpenChannel(),n.url,e,s,0,!1,r,"","",function(e,s){if(s)return t.isLoading=!1,void S(null,s,a);var r=e.messages,i=[];for(var l in r){var o=L.build(r[l],n);o&&i.push(o)}t.isLoading=!1,S(i,null,a)})):S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),a);else{if("function"!=typeof a){var i=Array.prototype.slice.call(arguments);"function"==typeof i.slice(-1)[0]&&(a=i.pop())}S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),a)}},this.load=function(e,s,r,a,i){if(t.isLoading)S(null,new p("Query in progress.",J.QUERY_IN_PROGRESS),i);else if(5===arguments.length)_(e)&&_(s)&&_(r)&&"boolean"==typeof a?(t.isLoading=!0,Z.getInstance().messageList(n.isOpenChannel(),n.url,e,s,r,!0,a,"","",function(e,s){if(s)return t.isLoading=!1,void S(null,s,i);var r=e.messages,a=[];for(var l in r){var o=L.build(r[l],n);o&&a.push(o)}t.isLoading=!1,S(a,null,i)})):S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),i);else{if("function"!=typeof i){var l=Array.prototype.slice.call(arguments);"function"==typeof l.slice(-1)[0]&&(i=l.pop())}S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),i)}}},K=function(){var e="";this.limit=20,this.isLoading=!1,this.hasNext=!0,this.nameKeyword=null,this.urlKeyword=null,this.customType=null;var n=this;this.next=function(t){this.hasNext?this.isLoading?S(null,new p("Query in progress.",J.QUERY_IN_PROGRESS),t):"string"!=typeof n.nameKeyword&&null!==n.nameKeyword||"string"!=typeof n.urlKeyword&&null!==n.urlKeyword||"string"!=typeof n.customType&&null!==n.customType||!_(n.limit)?S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),t):(n.isLoading=!0,Z.getInstance().loadOpenChannelList(e,n.limit,n.nameKeyword,n.urlKeyword,n.customType,function(s,r){if(r)return n.isLoading=!1,void S(null,r,t);var a=s;try{e=String(a.next)}catch(n){e=""}e||(n.hasNext=!1);var i=[];a.channels.forEach(function(e){var n=w.upsert(e);i.push(n)}),n.isLoading=!1,S(i,null,t)})):S([],null,t)}},q=function(e){var n=e,t=0x8000000000000000;this.hasMore=!0,this.isLoading=!1;var s=this;this.load=function(e,r,a,i){if(3===arguments.length||4===arguments.length)"function"==typeof a&&(i=a,a=""),a.toString().toLowerCase()===L.MESSAGE_TYPE_ADMIN||a===A.MessageTypeFilter.ADMIN?a="ADMM":a.toString().toLowerCase()===L.MESSAGE_TYPE_USER||a===A.MessageTypeFilter.USER?a="MESG":a.toString().toLowerCase()===L.MESSAGE_TYPE_FILE||a===A.MessageTypeFilter.FILE?a="FILE":null!==a&&void 0!==a&&a!==A.MessageTypeFilter.ALL||(a=""),_(e)&&"boolean"==typeof r&&"string"==typeof a?s.hasMore&&(s.isLoading?S(null,new p("Query in progress.",J.QUERY_IN_PROGRESS),i):(s.isLoading=!0,Z.getInstance().messageList(n.isOpenChannel(),n.url,t,e,0,!1,r,a,"",function(r,a){if(a)return s.isLoading=!1,void S(null,a,i);var l=r.messages,o=[];for(var c in l){var u=L.build(l[c],n);u&&(o.push(u),u.createdAt<=t&&(t=u.createdAt))}(o.length<=0||o.length<e)&&(s.hasMore=!1),s.isLoading=!1,S(o,null,i)}))):S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),i);else{if("function"!=typeof i){var l=Array.prototype.slice.call(arguments);"function"==typeof l.slice(-1)[0]&&(i=l.pop())}S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),i)}}},z=function(e,n){var t,s,r,a="";this.hasNext=!0,this.limit=20,this.isLoading=!1,this.userIds=[],this.metaDataKey="",this.metaDataValues=[];var i=this;switch(n&&(s=n),t=e){case z.ALL_USER:case z.BLOCKED_USER:r="users";break;case z.FILTERED_USER:this.userIds=n,r="users";break;case z.PARTICIPANT:r="participants";break;case z.MUTED_USER:r="muted_list";break;case z.BANNED_USER:r="banned_list"}this.next=function(n){if(i.hasNext)if(se.getInstance().hasLoggedIn())if(i.isLoading)S(null,new p("Query in progress.",J.QUERY_IN_PROGRESS),n);else if(!(_(i.limit)&&Array.isArray(i.userIds)&&"string"==typeof i.metaDataKey&&Array.isArray(i.metaDataValues))||i.metaDataKey&&I(i.metaDataValues)||!i.metaDataKey&&!I(i.metaDataValues))S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n);else{i.isLoading=!0;var l=function(t,s){if(s)return i.isLoading=!1,void S(null,s,n);(a=t.next)||(i.hasNext=!1);var l=t[r],o=[];for(var c in l)e===z.BANNED_USER?o.push(new G(l[c].user)):o.push(new G(l[c]));i.isLoading=!1,S(o,null,n)};switch(t){case z.ALL_USER:Z.getInstance().loadUserList(a,i.limit,[],i.metaDataKey,i.metaDataValues,l);break;case z.FILTERED_USER:Z.getInstance().loadUserList(a,i.limit,i.userIds,i.metaDataKey,i.metaDataValues,l);break;case z.BLOCKED_USER:Z.getInstance().loadBlockedUserList(se.getInstance().getCurrentUserId(),a,i.limit,l);break;case z.PARTICIPANT:Z.getInstance().loadOpenChannelParticipantList(s.url,a,i.limit,l);break;case z.MUTED_USER:Z.getInstance().loadMutedUserList(s,a,i.limit,l);break;case z.BANNED_USER:Z.getInstance().loadBannedUserList(s,a,i.limit,l)}}else n&&S(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED),n);else S([],null,n)}};z.ALL_USER="alluser",z.FILTERED_USER="filtereduser",z.BLOCKED_USER="blockeduser",z.PARTICIPANT="participant",z.MUTED_USER="muteduser",z.BANNED_USER="banneduser";var J=function(){};J.INVALID_INITIALIZATION=800100,J.CONNECTION_REQUIRED=800101,J.INVALID_PARAMETER=800110,J.NETWORK_ERROR=800120,J.NETWORK_ROUTING_ERROR=800121,J.MALFORMED_DATA=800130,J.MALFORMED_ERROR_DATA=800140,J.WRONG_CHANNEL_TYPE=800150,J.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160,J.QUERY_IN_PROGRESS=800170,J.ACK_TIMEOUT=800180,J.LOGIN_TIMEOUT=800190,J.WEBSOCKET_CONNECTION_CLOSED=800200,J.WEBSOCKET_CONNECTION_FAILED=800210,J.REQUEST_FAILED=800220,J.FILE_UPLOAD_CANCEL_FAILED=800230,J.REQUEST_CANCELLED=800240;var j=function(t){var s,a,l=!1;t||(t=new j.WSClientHandler);this.getConnectionState=function(){return 1===s.readyState?se.getInstance().connectionState.OPEN:se.getInstance().connectionState.CLOSED};var o=new function(){var s,r;this.ping=function(){n&&e.log("PING"),clearTimeout(s),clearTimeout(r),s=setTimeout(function(){var a=Y.bPing();se.getInstance().wsClient.send(a),r=setTimeout(function(){n&&e.log("PING Timeout"),clearTimeout(s),clearTimeout(r),t.onError()},5e3)},15e3)},this.stop=function(){clearTimeout(s),clearTimeout(r)}};this.connect=function(c,u,d){n&&e.log("WSClient connect called"),a=d;var h=null,I=!1;try{h="undefined"==typeof WebSocket?require("websocket").w3cwebsocket:WebSocket}catch(e){h=WebSocket}try{var _="/?p=JS&pv="+encodeURIComponent(r)+"&sv="+encodeURIComponent(i)+"&ai="+encodeURIComponent(y);if(Z.getInstance().sessionKey?_+="&key="+encodeURIComponent(Z.getInstance().sessionKey):_+="&user_id="+encodeURIComponent(c)+"&access_token="+encodeURIComponent(u),!(s=new h(a+_)))return void t.onError("ws is not exist.")}catch(e){return void t.onError(e)}if(n)try{window.ws=s}catch(e){}s.onopen=function(s){o&&o.ping(),n&&e.log("WSClient onopen called"),t.onOpen(s)},s.onmessage=function(s){(new Date).getTime();var r=s.data.split("\n");for(var a in r){var i=r[a];if(i&&"string"==typeof i){try{if("PONG"===i.substring(0,4)){o&&o.ping();continue}}catch(s){n&&e.log("ws.onmessage-command check error: ",s)}t.onMessage(i)}}},s.onclose=function(s){n&&e.log("WSClient ws.onclose called - explicitDisconnect: ",l),o&&o.stop(),l?t.onClose(s):I||t.onError(s),l=!1},s.onerror=function(s){n&&e.log("WSClient ws.onerror called: "),o&&o.stop(),I=!0,t.onError(s)}},this.disconnect=function(r,a){n&&e.log("WSClient disconnect called [explicit]: ",r),o&&o.stop(),o=null,l=1==r,s&&(s.onopen=function(){},s.onmessage=function(){},s.onclose=function(){a&&a()},s.onerror=function(){},s.close(),s=null),l?t.onClose():t.onError();var i=se.getInstance().connectionCallback;se.getInstance().connectionCallback=[],i.forEach(function(e){S(null,new p("Connection Closed.",J.WEBSOCKET_CONNECTION_CLOSED),e)}),i=[],l=!1},this.send=function(e,n){1!==s.readyState?n&&n(null,new p("Connection is not valid. Please reconnect.",J.WEBSOCKET_CONNECTION_CLOSED)):(s.send(e.encode()),n&&n(null,null))}};j.WSClientHandler=function(){this.onReady=function(){},this.onOpen=function(){},this.onClose=function(){},this.onMessage=function(){},this.onError=function(){}};var Z=function(){var e=Z.getInstance();if(e)return e;this.sessionKey;var n=0;this.getMessageChangeLogsByToken=function(e,n,t,s){var r="";r=e?Z.API_OPENCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS.replace("%s",encodeURIComponent(n)):Z.API_GROUPCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS.replace("%s",encodeURIComponent(n));var a={};t&&(a.token=t),c(r,a,s)},this.setChannelInvitationPreference=function(e,n,t){var s=Z.API_USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE.replace("%s",encodeURIComponent(e));d(s,{auto_accept:n},t)},this.getChannelInvitationPreference=function(e,n){var t=Z.API_USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE.replace("%s",encodeURIComponent(e));c(t,n)},this.getGroupChannelCount=function(e,n,t){var s=Z.API_USERS_USERID_GROUP_CHANNEL_COUNT.replace("%s",encodeURIComponent(e)),r="";r=n===H.memberState.JOINED?"joined":n===H.memberState.INVITED?"invited":n===H.memberState.INVITED_BY_FRIEND?"invited_by_friend":n===H.memberState.INVITED_BY_NON_FRIEND?"invited_by_non_friend":"all",c(s,{state:r},t)},this.getTotalUnreadMessageCount=function(e,n){var t=Z.API_USERS_USERID_UNREAD_MESSAGE_COUNT.replace("%s",encodeURIComponent(e));c(t,n)},this.getTotalUnreadChannelCount=function(e,n){var t=Z.API_USERS_USERID_UNREAD_CHANNEL_COUNT.replace("%s",encodeURIComponent(e));c(t,n)},this.checkRouting=function(e){if(se.getInstance()&&se.getInstance().customApiHost&&se.getInstance().customWsHost)"function"==typeof e&&e({API_HOST:se.getInstance().customApiHost,WS_HOST:se.getInstance().customWsHost});else{var r=(new Date).getTime()/1e3;0===n||n-r>300?U(Z.API_ROUTING_URL.replace("%s",y),{},"GET",{SendBird:l+y},function(a,i){i?e(null,new p("Server is unreachable.",J.NETWORK_ROUTING_ERROR)):(t=a.ws_server,s=a.api_server,n=r,"function"==typeof e&&e({API_HOST:s,WS_HOST:t}))}):e({API_HOST:se.getInstance().getCurrentApiHost(),WS_HOST:se.getInstance().getCurrentWsHost()},null)}};var r=function(e,n,t,s,r,i,o,c,u,d){se.getInstance().hasLoggedIn()?Z.getInstance().checkRouting(function(n,I){if(I)o(null,new p("Request failed.",J.REQUEST_FAILED));else{var _=R();_.open("POST",n.API_HOST+e,!0),_.setRequestHeader("SendBird",l+y),_.setRequestHeader("Session-Key",Z.getInstance().sessionKey);var E=a?new a:new FormData;s&&"undefined"!=typeof Blob?E.append("file",new Blob([t],{type:s}),t.name):E.append("file",t,t.name),i&&E.append("channel_url",i);for(var f in r){var A=parseInt(f)+1;E.append("thumbnail"+A,r[f].maxWidth+","+r[f].maxHeight)}_.onload=function(){u&&u[d]&&delete u[d];_.status>=200&&_.status<400?h(null,JSON.parse(_.responseText),o):h({status:_.status,statusText:_.statusText,response:_.responseText},null,o)},_.onerror=function(e){u&&u[d]&&delete u[d],o(null,new p(_.statusText,J.REQUEST_FAILED))},_.onabort=function(e){u&&u[d]&&delete u[d],o(null,new p("File upload has been cancelled.",J.REQUEST_CANCELLED))},_.upload.onprogress=function(e){e.lengthComputable&&e.loaded>=e.total&&u&&u[d]&&delete u[d],c&&c(e)},E.oldIE?(_.setRequestHeader("Content-Type","multipart/form-data; boundary="+E.boundary),_.send(E.toString())):_.send(E),u&&(u[d]=_)}}):o&&o(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED))},i=function(e,n,t){"function"==typeof n&&(t=n,n={}),se.getInstance().hasLoggedIn()?Z.getInstance().checkRouting(function(s,r){r?t(null,new p("Request failed.",J.REQUEST_FAILED)):U(s.API_HOST+e,n,"DELETE",{"Session-Key":Z.getInstance().sessionKey,SendBird:l+y},t)}):t&&t(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED))},o=function(e){var n="";for(var t in e)e.hasOwnProperty(t)&&(n+=encodeURIComponent(e[t])+",");return n.length>1&&(n=n.substring(0,n.length-1)),n},c=function(e,n,t){if("function"==typeof n&&(t=n,n={}),se.getInstance().hasLoggedIn()){var s,r="";if(n){for(var a in n)""!==r&&(r+="&"),r+=a+"="+n[a];s=e+"?"+r}else s=e;Z.getInstance().checkRouting(function(e,r){r?t(null,new p("Request failed.",J.REQUEST_FAILED)):U(e.API_HOST+s,n,"GET",{"Session-Key":Z.getInstance().sessionKey,SendBird:l+y},t)})}else t&&t(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED))},u=function(e,n,t){"function"==typeof n&&(t=n,n={}),se.getInstance().hasLoggedIn()?Z.getInstance().checkRouting(function(s,r){r?t(null,r):U(s.API_HOST+e,n,"POST",{"Session-Key":Z.getInstance().sessionKey,SendBird:l+y},t)}):t&&t(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED))},d=function(e,n,t){"function"==typeof n&&(t=n,n={}),se.getInstance().hasLoggedIn()?Z.getInstance().checkRouting(function(s,r){r||U(s.API_HOST+e,n,"PUT",{"Session-Key":Z.getInstance().sessionKey,SendBird:l+y},t)}):t&&t(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED))};this.addFriends=function(e,n,t){var s=Z.API_FRIENDS.replace("%s",encodeURIComponent(e));u(s,{user_ids:n},t)},this.deleteFriends=function(e,n,t){var s=Z.API_FRIENDS.replace("%s",encodeURIComponent(e));n.length>0&&(s+="?user_ids=",n.forEach(function(e){s+=encodeURIComponent(e)+","}),s=s.substring(0,s.length-1));i(s,{},t)},this.deleteFriendDiscoveries=function(e,n,t){var s=Z.API_FRIENDS_DISCOVERIES.replace("%s",encodeURIComponent(e));n.length>0&&(s+="?friend_discovery_keys=",n.forEach(function(e){s+=encodeURIComponent(e)+","}),s=s.substring(0,s.length-1));i(s,{},t)},this.uploadFriendDiscoveries=function(e,n,t){var s=Z.API_FRIENDS_DISCOVERIES.replace("%s",encodeURIComponent(e)),r={friend_discoveries:[]};n.forEach(function(e){r.friend_discoveries.push({friend_discovery_key:e.friendDiscoveryKey,friend_name:"string"==typeof e.friendName||e.friendName?e.friendName:null})}),d(s,r,t)},this.getFriendChangeLogsByToken=function(e,n,t){var s=Z.API_FRIENDS_CHANGE_LOGS.replace("%s",encodeURIComponent(e)),r={};n&&(r.token=n),c(s,r,t)},this.friendListQuery=function(e,n,t,s){var r=Z.API_FRIENDS.replace("%s",encodeURIComponent(e)),a={limit:t,token:encodeURIComponent(n)};c(r,a,s)},this.createUserMetaData=function(e,n,t){var s=Z.API_USERS_USERID_METADATA.replace("%s",encodeURIComponent(e)),r={};r.metadata=n,u(s,r,t)},this.updateUserMetaData=function(e,n,t,s){var r=Z.API_USERS_USERID_METADATA.replace("%s",encodeURIComponent(e)),a={};a.metadata=n,a.upsert=t,d(r,a,s)},this.deleteAllUserMetaData=function(e,n){var t=Z.API_USERS_USERID_METADATA.replace("%s",encodeURIComponent(e));i(t,{},n)},this.deleteUserMetaData=function(e,n,t){var s=Z.API_USERS_USERID_METADATA_KEY.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));i(s,{},t)},this.resetMyHistory=function(e,n){var t=Z.API_GROUPCHANNELS_RESET_USER_HISTORY.replace("%s",encodeURIComponent(e));d(t,{},n)},this.groupChannelInvite=function(e,n,t){var s=Z.API_GROUPCHANNELS_CHANNELURL_INVITE.replace("%s",encodeURIComponent(e)),r={},a=[];try{Array.isArray(n)?a=n:a.push(n)}catch(e){t(null,new p("Invalid parameter.",J.INVALID_PARAMETER))}r.user_ids=a,u(s,r,t)},this.acceptInvitation=function(e,n,t){var s=Z.API_GROUPCHANNELS_CHANNELURL_ACCEPT_INVITATION.replace("%s",encodeURIComponent(e)),r={};r.user_id=n,d(s,r,t)},this.declineInvitation=function(e,n,t){var s=Z.API_GROUPCHANNELS_CHANNELURL_DECLINE_INVITATION.replace("%s",encodeURIComponent(e)),r={};r.user_id=n,d(s,r,t)},this.groupChannelHide=function(e,n,t,s){var r=Z.API_GROUPCHANNELS_CHANNELURL_HIDE.replace("%s",encodeURIComponent(e)),a={};a.user_id=n,a.hide_previous_messages=t,d(r,a,s)},this.publicGroupChannelJoin=function(e,n,t){var s=Z.API_GROUPCHANNELS_CHANNELURL_JOIN.replace("%s",encodeURIComponent(e)),r={};r.user_id=n,d(s,r,t)},this.groupChannelLeave=function(e,n,t){var s=Z.API_GROUPCHANNELS_CHANNELURL_LEAVE.replace("%s",encodeURIComponent(e)),r={};r.user_id=n,d(s,r,t)},this.groupChannelMarkAsRead=function(e,n,t){var s=Z.API_GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASREAD.replace("%s",encodeURIComponent(e)),r={};r.user_id=n,d(s,r,t)},this.groupChannelMarkAsReadAll=function(e,n,t){var s=Z.API_USERS_USERID_MARKASREADALL.replace("%s",encodeURIComponent(e)),r={};n&&(r.channel_urls=n),d(s,r,t)},this.messageList=function(e,n,t,s,r,a,i,l,o,u){var d;d=e?String(Z.API_OPENCHANNELS_CHANNELURL_MESSAGES.replace("%s",n)):String(Z.API_GROUPCHANNELS_CHANNELURL_MESSAGES.replace("%s",n));var h={};h.is_sdk=String(!0),h.message_ts=String(t),h.prev_limit=String(s),h.next_limit=String(r),h.include=String(a),h.reverse=String(i),l&&(h.message_type=String(l)),o&&(h.custom_type=String(o)),c(d,h,u)},this.messageListByID=function(e,n,t,s,r,a,i,l,o,u){var d;d=e?String(Z.API_OPENCHANNELS_CHANNELURL_MESSAGES.replace("%s",n)):String(Z.API_GROUPCHANNELS_CHANNELURL_MESSAGES.replace("%s",n));var h={};h.is_sdk=String(!0),h.message_id=t,h.prev_limit=String(s),h.next_limit=String(r),h.include=String(a),h.reverse=String(i),l&&(h.message_type=String(l)),o&&(h.custom_type=String(o)),c(d,h,u)},this.login=function(e,n,t){var s=Z.API_USERS_USERID_LOGIN.replace("%s",encodeURIComponent(e)),r={};r.app_id=y,n&&(r.access_token=n),u(s,r,function(e,n){n?t(null,n):(Z.getInstance().sessionKey=e.key,Z.getInstance().ekey=e.ekey,t(e,n))})},this.updateUserInfo=function(e,n,t,s){var r={};n&&(r.nickname=n),t&&(r.profile_url=t);var a=String(Z.API_USERS_USERID).replace("%s",encodeURIComponent(e));d(a,r,s)},this.updateCurrentUserInfoWithFile=function(e,n,t,s){if("string"==typeof t)this.updateUserInfo(e,n,t,s);else{var r=a?new a:new FormData;r.append("nickname",n),r.append("profile_file",t,t.name);var i=String(Z.API_USERS_USERID).replace("%s",encodeURIComponent(e));d(i,r,s)}},this.getGroupChannel=function(e,n,t,s){var r=Z.API_GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(e)),a={member:String(n),read_receipt:String(t)};c(r,a,s)},this.getOpenChannel=function(e,n){var t=Z.API_OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(e));c(t,n)},this.createGroupChannel=function(e,n,t,s,r,i,l,o,c,d,h){var I=Z.API_GROUPCHANNELS,_=[];"string"==typeof e?_.push(e):e.forEach(function(e){_.push(e)});var E,p=_.filter(function(e,n){return _.indexOf(e)===n}),f=o.isPublic,A=o.channelUrl;s&&"string"!=typeof s?(E=a?new a:new FormData,s&&E.append("cover_file",s,s.name),E.append("user_ids",p),null!==A&&E.append("channel_url",A),null!==n&&E.append("is_distinct",n),null!==l&&E.append("is_super",l),null!==f&&E.append("is_public",f),null!==d&&E.append("is_ephemeral",d),null!==t&&"string"==typeof t&&E.append("name",t),r&&E.append("data",r),i&&E.append("custom_type",i),Array.isArray(c)&&c.length>0&&E.append("operator_ids",c)):(E={},null!==s&&"string"==typeof s&&(E.cover_url=s),E.user_ids=p,null!==A&&(E.channel_url=A),null!==n&&(E.is_distinct=n),null!==l&&(E.is_super=l),null!==f&&(E.is_public=f),null!==d&&(E.is_ephemeral=d),null!==t&&"string"==typeof t&&(E.name=t),r&&(E.data=r),i&&(E.custom_type=i),Array.isArray(c)&&c.length>0&&(E.operator_ids=c)),u(I,E,h)},this.createOpenChannel=function(e,n,t,s,r,i){var l,o=String(Z.API_OPENCHANNELS);n&&"string"!=typeof n?(l=a?new a:new FormData,n&&l.append("cover_file",n,n.name),null!==e&&"string"==typeof e&&l.append("name",e),t&&l.append("data",t),s&&(Array.isArray(s)?l.append("operators",s):l.append("operators",[s])),r&&l.append("custom_type",r)):(l={},null!==n&&"string"==typeof n&&(l.cover_url=n),null!==e&&"string"==typeof e&&(l.name=e),t&&(l.data=t),s&&(Array.isArray(s)?l.operators=s:l.operators=[s]),r&&(l.custom_type=r)),u(o,l,i)},this.updateGroupChannel=function(e,n,t,s,r,i,l,o){var c,u=String(Z.API_GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(e)));s&&"string"!=typeof s?(c=a?new a:new FormData,null!==n&&c.append("is_distinct",n),null!==l&&c.append("is_public",l),s&&c.append("cover_file",s,s.name),null!==t&&"string"==typeof t&&c.append("name",t),null!==r&&"string"==typeof r&&c.append("data",r),null!==i&&"string"==typeof i&&c.append("custom_type",i)):(c={},null!==n&&(c.is_distinct=n),null!==l&&(c.is_public=l),null!==s&&"string"==typeof s&&(c.cover_url=s),null!==t&&"string"==typeof t&&(c.name=t),null!==r&&"string"==typeof r&&(c.data=r),null!==i&&"string"==typeof i&&(c.custom_type=i)),d(u,c,o)},this.updateOpenChannel=function(e,n,t,s,r,i,l){var o,c=String(Z.API_OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(e)));t&&"string"!=typeof t?(o=a?new a:new FormData,t&&o.append("cover_file",t,t.name),null!==n&&"string"==typeof n&&o.append("name",n),null!==s&&"string"==typeof s&&o.append("data",s),null!==r&&(Array.isArray(r)?o.append("operators",r):o.append("operators",[r])),null!==i&&"string"==typeof i&&o.append("custom_type",i)):(o={},null!==t&&"string"==typeof t&&(o.cover_url=t),null!==n&&"string"==typeof n&&(o.name=n),null!==s&&"string"==typeof s&&(o.data=s),null!==r&&(Array.isArray(r)?o.operators=r:o.operators=[r]),null!==i&&"string"==typeof i&&(o.custom_type=i)),d(c,o,l)},this.deleteOpenChannel=function(e,n){var t=String(Z.API_OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(e)));i(t,{},n)},this.createMetaCounters=function(e,n,t,s){var r;r=e?Z.API_OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n)):Z.API_GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n));var a={};a.metacounter=t,u(r,a,s)},this.updateMetaCounters=function(e,n,t,s,r,a){var i;i=e?Z.API_OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n)):Z.API_GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n));var l={};switch(l.metacounter=t,l.upsert=s,r){case Z.UPDATE_META_COUNTER_MODE_SET:l.mode="set";break;case Z.UPDATE_META_COUNTER_MODE_INC:l.mode="increase";break;case Z.UPDATE_META_COUNTER_MODE_DEC:l.mode="decrease"}d(i,l,a)},this.getAllMetaCounters=function(e,n,t){this.getMetaCounters(e,n,{},t)},this.getMetaCounters=function(e,n,t,s){var r;r=e?Z.API_OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n)):Z.API_GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n));var a=o(t);c(r,{keys:a},s)},this.deleteMetaCounter=function(e,n,t,s){var r="";r=e?Z.API_OPENCHANNELS_CHANNELURL_METACOUNTER_KEY.replace("%s",encodeURIComponent(n)).replace("%s",t):Z.API_GROUPCHANNELS_CHANNELURL_METACOUNTER_KEY.replace("%s",encodeURIComponent(n)).replace("%s",t);i(r,{},s)},this.deleteAllMetaCounters=function(e,n,t){var s="";s=e?Z.API_OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n)):Z.API_GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n));i(s,{},t)},this.createMetaData=function(e,n,t,s){var r="";r=e?Z.API_OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n)):Z.API_GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n));var a={},i={};for(var l in t){var o=t[l];i[l]=o}a.metadata=i,u(r,a,s)},this.updateMetaData=function(e,n,t,s,r){var a="";a=e?Z.API_OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n)):Z.API_GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n));var i={},l={};for(var o in t){var c=t[o];l[o]=c}i.metadata=l,i.upsert=s,d(a,i,r)},this.getAllMetaData=function(e,n,t){this.getMetaData(e,n,{},t)},this.getMetaData=function(e,n,t,s){var r="";r=e?Z.API_OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n)):Z.API_GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n));var a=o(t);c(r,{keys:a},s)},this.deleteMetaData=function(e,n,t,s){var r="";r=e?Z.API_OPENCHANNELS_CHANNELURL_METADATA_KEY.replace("%s",encodeURIComponent(n)).replace("%s",t):Z.API_GROUPCHANNELS_CHANNELURL_METADATA_KEY.replace("%s",encodeURIComponent(n)).replace("%s",t),i(r,{},s)},this.deleteAllMetaData=function(e,n,t){var s="";s=e?Z.API_OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n)):Z.API_GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n)),i(s,{},t)},this.loadUserList=function(e,n,t,s,r,a){var i=Z.API_USERS,l={token:encodeURIComponent(e),limit:String(n)};if(!I(t))try{var o="";for(var u in t){var d=t[u];o+=encodeURIComponent(d)+","}o.length>1&&(o=o.substring(0,o.length-1)),l.user_ids=o}catch(e){}if(s&&!I(r)){var h="";r.forEach(function(e){h+=encodeURIComponent(e)+","}),h.length>0&&(h=h.substring(0,h.length-1)),l.metadatakey=encodeURIComponent(s),l.metadatavalues_in=h}c(i,l,a)},this.loadBlockedUserList=function(e,n,t,s){var r=Z.API_USERS_USERID_BLOCK.replace("%s",encodeURIComponent(e)),a={token:encodeURIComponent(n),limit:String(t)};c(r,a,s)},this.loadOpenChannelList=function(e,n,t,s,r,a){var i=Z.API_OPENCHANNELS,l={token:encodeURIComponent(e),limit:String(n)};null!==t&&(l.name_contains=encodeURIComponent(t)),s&&(l.url_contains=encodeURIComponent(s)),null!==r&&(l.custom_type=encodeURIComponent(r)),c(i,l,a)},this.uploadFile=function(e,n,t,s,a,i,l,o){r(Z.API_STORAGE_FILE,0,e,n,t,s,a,i,l,o)},this.uploadProfileImage=function(e,n){r(Z.API_STORAGE_PROFILE,0,e,"",[],"",n)},this.loadGroupChannelMemberList=function(e,n,t,s,r,a){var i=Z.API_GROUPCHANNELS_MEMBERS.replace("%url",encodeURIComponent(e)),l={token:encodeURIComponent(n),limit:t,muted_member_filter:s.toLowerCase(),operator_filter:r.toLowerCase()};c(i,l,a)},this.loadPublicGroupChannelList=function(e,n,t,s,r,a,i,l,o,u,d){var h=Z.API_GROUPCHANNELS,I={public_mode:H.publicChannelFilter.PUBLIC,token:encodeURIComponent(e),limit:String(n),show_member:!0,show_read_receipt:!0,show_empty:String(t),order:s};if(r)try{I.name_contains=encodeURIComponent(r)}catch(e){}if(a.length>0)try{I.channel_urls=a.map(function(e){return encodeURIComponent(e)}).join(",")}catch(e){}if(i.length>0){var _="";i.forEach(function(e){_+=encodeURIComponent(e)+","}),_=_.substring(0,_.length-1),I.custom_types=_}l&&(I.custom_type_startswith=l),I.super_mode=o,I.public_membership_mode=u,c(h,I,d)},this.loadUserGroupChannelList=function(e,n,t,s,r,a,i,l,u,d,h,I,_,E,p,f){var A=Z.API_MYGROUPCHANNELS.replace("%s",encodeURIComponent(e)),g=a.userIds,m=!a.includeMode,N=a.queryType,C={token:encodeURIComponent(n),limit:String(t),show_member:!0,show_read_receipt:!0,show_empty:String(s),order:r,member_state_filter:_};if(h.length>0){var R="";h.forEach(function(e){R+=encodeURIComponent(e)+","}),R=R.substring(0,R.length-1),C.custom_types=R}else d&&(C.custom_type=encodeURIComponent(d));if(i)try{C.members_nickname_contains=encodeURIComponent(i)}catch(e){}if(l)try{C.name_contains=encodeURIComponent(l)}catch(e){}if(g.length>0)try{m?C.members_exactly_in=o(g):(C.members_include_in=o(g),C.query_type=N)}catch(e){}if(u.length>0)try{C.channel_urls=u.map(function(e){return encodeURIComponent(e)}).join(",")}catch(e){}C.super_mode=E,C.public_mode=p,I&&(C.custom_type_startswith=I),c(A,C,f)},this.loadOpenChannelParticipantList=function(e,n,t,s){var r=Z.API_OPENCHANNELS_CHANNELURL_PARTICIPANTS.replace("%s",e),a={token:encodeURIComponent(n),limit:String(t)};c(r,a,s)},this.loadMutedUserList=function(e,n,t,s){var r=e.isOpenChannel()?Z.API_OPENCHANNELS_CHANNELURL_MUTE.replace("%s",e.url):Z.API_GROUPCHANNELS_CHANNELURL_MUTE.replace("%s",e.url),a={token:encodeURIComponent(n),limit:String(t)};c(r,a,s)},this.loadBannedUserList=function(e,n,t,s){var r=e.isOpenChannel()?Z.API_OPENCHANNELS_CHANNELURL_BAN.replace("%s",e.url):Z.API_GROUPCHANNELS_CHANNELURL_BAN.replace("%s",e.url),a={token:encodeURIComponent(n),limit:String(t)};c(r,a,s)},this.setPushTemplate=function(e,n,t){var s=Z.API_USERS_USERID_PUSH_TEMPLATE.replace("%s",encodeURIComponent(e));d(s,{name:n},t)},this.getPushTemplate=function(e,n){var t=Z.API_USERS_USERID_PUSH_TEMPLATE.replace("%s",encodeURIComponent(e));c(t,n)},this.setDoNotDisturb=function(e,n,t,s,r,a,i,l){var o=Z.API_USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(e));d(o,{do_not_disturb:n,start_hour:t,start_min:s,end_hour:r,end_min:a,timezone:i},l)},this.getDoNotDisturb=function(e,n){var t=Z.API_USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(e));c(t,n)},this.setPushPreference=function(e,n,t,s){var r=Z.API_USERS_USERID_PUSHPREFERENCE_CHANNELURL.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n)),a={};a.enable=t,d(r,a,s)},this.getPushPreference=function(e,n,t){var s=Z.API_USERS_USERID_PUSHPREFERENCE_CHANNELURL.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));c(s,t)},this.registerGCMPushToken=function(e,n,t){var s=Z.API_USERS_USERID_PUSH_GCM.replace("%s",encodeURIComponent(e));u(s,{gcm_reg_token:n},t)},this.unregisterGCMPushToken=function(e,n,t){var s=Z.API_USERS_USERID_PUSH_GCM_TOKEN.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));i(s,t)},this.unregisterGCMPushTokenAll=function(e,n){var t=Z.API_USERS_USERID_PUSH_GCM.replace("%s",encodeURIComponent(e));i(t,n)},this.registerAPNSPushToken=function(e,n,t){var s=Z.API_USERS_USERID_PUSH_APNS.replace("%s",encodeURIComponent(e));u(s,{apns_device_token:n},t)},this.unregisterAPNSPushToken=function(e,n,t){var s=Z.API_USERS_USERID_PUSH_APNS_TOKEN.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));i(s,t)},this.unregisterAPNSPushTokenAll=function(e,n){var t=Z.API_USERS_USERID_PUSH_APNS.replace("%s",encodeURIComponent(e));i(t,n)},this.unregisterPushTokenAll=function(e,n){var t=Z.API_USERS_USERID_PUSH.replace("%s",encodeURIComponent(e));i(t,n)},this.blockUser=function(e,n,t){var s=Z.API_USERS_USERID_BLOCK.replace("%s",encodeURIComponent(e));u(s,{target_id:n},t)},this.unblockUser=function(e,n,t){var s=Z.API_USERS_USERID_BLOCK_TARGETID.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));i(s,{},t)},this.banUser=function(e,n,t,s,r,a){var i=r?Z.API_GROUPCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(e)):Z.API_OPENCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(e)),l={user_id:n};t&&(l.description=t),l.seconds=String(s),u(i,l,a)},this.unbanUser=function(e,n,t,s){var r=t?Z.API_GROUPCHANNELS_CHANNELURL_BAN_USERID.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n)):Z.API_OPENCHANNELS_CHANNELURL_BAN_USERID.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));i(r,{},s)},this.muteUser=function(e,n,t,s){var r=t?Z.API_GROUPCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(e)):Z.API_OPENCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(e));u(r,{user_id:n},s)},this.unmuteUser=function(e,n,t,s){var r=t?Z.API_GROUPCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n)):Z.API_OPENCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));i(r,{},s)},this.deleteMessage=function(e,n,t,s){var r="";r=e?Z.API_OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(n)).replace("%s",encodeURIComponent(t)):Z.API_GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(n)).replace("%s",encodeURIComponent(t)),i(r,{},s)},this.freeze=function(e,n,t,s){var r=n?Z.API_GROUPCHANNELS_CHANNELURL_FREEZE.replace("%s",encodeURIComponent(e)):Z.API_OPENCHANNELS_CHANNELURL_FREEZE.replace("%s",encodeURIComponent(e));d(r,{freeze:t},s)}},X=null;Z.getInstance=function(){return null===X?null:X},Z.API_VERSION="v3",Z.API_ROUTING_URL="https://api-p.sendbird.com/routing/%s",Z.API_USERS="/%v/users".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_LOGIN="/%v/users/%s/login".replace("%v",Z.API_VERSION),Z.API_USERS_USERID="/%v/users/%s".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_METADATA="/%v/users/%s/metadata".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_METADATA_KEY="/%v/users/%s/metadata/%s".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_UNREAD_MESSAGE_COUNT="/%v/users/%s/unread_message_count".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_UNREAD_CHANNEL_COUNT="/%v/users/%s/unread_channel_count".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_MARKASREADALL="/%v/users/%s/mark_as_read_all".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_PUSH_GCM_TOKEN="/%v/users/%s/push/gcm/%s".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_PUSH_GCM="/%v/users/%s/push/gcm".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_PUSHPREFERENCE_CHANNELURL="/%v/users/%s/push_preference/%s".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_PUSHPREFERENCE="/%v/users/%s/push_preference/".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_PUSH_TEMPLATE="/%v/users/%s/push/template".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_BLOCK="/%v/users/%s/block".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_BLOCK_TARGETID="/%v/users/%s/block/%s".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_PUSH_APNS_TOKEN="/%v/users/%s/push/apns/%s".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_PUSH_APNS="/%v/users/%s/push/apns".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_PUSH="/%v/users/%s/push".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE="/%v/users/%s/channel_invitation_preference".replace("%v",Z.API_VERSION),Z.API_USERS_USERID_GROUP_CHANNEL_COUNT="/%v/users/%s/group_channel_count".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS="/%v/open_channels".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL="/%v/open_channels/%s".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL_MESSAGES="/%v/open_channels/%s/messages".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID="/%v/open_channels/%s/messages/%s".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL_PARTICIPANTS="/%v/open_channels/%s/participants".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL_METADATA="/%v/open_channels/%s/metadata".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL_METADATA_KEY="/%v/open_channels/%s/metadata/%s".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL_METACOUNTER="/%v/open_channels/%s/metacounter".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL_METACOUNTER_KEY="/%v/open_channels/%s/metacounter/%s".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL_BAN="/%v/open_channels/%s/ban".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL_BAN_USERID="/%v/open_channels/%s/ban/%s".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL_MUTE="/%v/open_channels/%s/mute".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL_MUTE_USERID="/%v/open_channels/%s/mute/%s".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL_FREEZE="/%v/open_channels/%s/freeze".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS="/%v/group_channels".replace("%v",Z.API_VERSION),Z.API_MYGROUPCHANNELS="/%v/users/%s/my_group_channels".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL="/%v/group_channels/%s".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_INVITE="/%v/group_channels/%s/invite".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_ACCEPT_INVITATION="/%v/group_channels/%s/accept".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_DECLINE_INVITATION="/%v/group_channels/%s/decline".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_HIDE="/%v/group_channels/%s/hide".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_LEAVE="/%v/group_channels/%s/leave".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_JOIN="/%v/group_channels/%s/join".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_MESSAGES="/%v/group_channels/%s/messages".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASREAD="/%v/group_channels/%s/messages/mark_as_read".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_MESSAGES_TOTALCOUNT="/%v/group_channels/%s/messages/total_count".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_MESSAGES_UNREADCOUNT="/%v/group_channels/%s/messages/unread_count".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID="/%v/group_channels/%s/messages/%s".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_MEMBERS="/%v/group_channels/%s/members".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_METADATA="/%v/group_channels/%s/metadata".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_METADATA_KEY="/%v/group_channels/%s/metadata/%s".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_METACOUNTER="/%v/group_channels/%s/metacounter".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_METACOUNTER_KEY="/%v/group_channels/%s/metacounter/%s".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_RESET_USER_HISTORY="/%v/group_channels/%s/reset_user_history".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_MEMBERS="/%v/group_channels/%url/members".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_BAN="/%v/group_channels/%s/ban".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_BAN_USERID="/%v/group_channels/%s/ban/%s".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_MUTE="/%v/group_channels/%s/mute".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_MUTE_USERID="/%v/group_channels/%s/mute/%s".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_FREEZE="/%v/group_channels/%s/freeze".replace("%v",Z.API_VERSION),Z.API_STORAGE_FILE="/%v/storage/file".replace("%v",Z.API_VERSION),Z.API_STORAGE_PROFILE="/%v/storage/profile_image".replace("%v",Z.API_VERSION),Z.API_OPENCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS="/%v/open_channels/%s/messages/changelogs".replace("%v",Z.API_VERSION),Z.API_GROUPCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS="/%v/group_channels/%s/messages/changelogs".replace("%v",Z.API_VERSION),Z.API_FRIENDS="/%v/users/%s/friends".replace("%v",Z.API_VERSION),Z.API_FRIENDS_CHANGE_LOGS="/%v/users/%s/friends/changelogs".replace("%v",Z.API_VERSION),Z.API_FRIENDS_DISCOVERIES="/%v/users/%s/friend_discoveries".replace("%v",Z.API_VERSION),Z.UPDATE_META_COUNTER_MODE_SET=0,Z.UPDATE_META_COUNTER_MODE_INC=1,Z.UPDATE_META_COUNTER_MODE_DEC=2;var $=function(e,n,t,s){c?this[t]=e[n]:Object.defineProperty(e,t,{get:function(){return"_coverUrl"===n||"_coverImage"===n?e._channelCover:e[n]},set:function(t){if("file"===s){if("string"==typeof t||"object"!=typeof t)throw new p("Invalid parameter.",J.INVALID_PARAMETER)}else if(s&&typeof t!==s)throw new p("Invalid parameter.",J.INVALID_PARAMETER);e[n]=t,"_coverUrl"!==n&&"_coverImage"!==n||(e._channelCover=t)}})},ee=function(){this._isDistinct=null,$(this,"_isDistinct","isDistinct","boolean"),this._isSuper=null,$(this,"_isSuper","isSuper","boolean"),this._isPublic=null,$(this,"_isPublic","isPublic","boolean"),this._channelUrl=null,$(this,"_channelUrl","channelUrl","string"),this._name=null,$(this,"_name","name","string"),this._data=null,$(this,"_data","data","string"),this._customType=null,$(this,"_customType","customType","string"),this._channelCover=null,$(this,"_channelCover","channelCover",null),this._coverUrl=null,$(this,"_coverUrl","coverUrl","string"),this._coverImage=null,$(this,"_coverImage","coverImage","file"),this._operatorIds=[],this._operators=null,c?this.operators=this._operators:Object.defineProperty(this,"operators",{get:function(){return this._operators},set:function(e){if(!Array.isArray(e))throw new p("Invalid parameter.",J.INVALID_PARAMETER);for(var n=[],t=0;t<e.length;t++){if(!e[t].hasOwnProperty("userId"))throw n=[],new p("Invalid parameter.",J.INVALID_PARAMETER);n.push(e[t].userId)}this._operatorIds=n}}),this._operatorUserIds=null,c?this.operatorUserIds=this._operatorUserIds:Object.defineProperty(this,"operatorUserIds",{get:function(){return this._operatorUserIds},set:function(e){if(!Array.isArray(e))throw new p("Invalid parameter.",J.INVALID_PARAMETER);for(var n=[],t=0;t<e.length;t++){if("string"!=typeof e[t])throw n=[],new p("Invalid parameter.",J.INVALID_PARAMETER);n.push(e[t])}this._operatorIds=n}}),this._isEphemeral=null,$(this,"_isEphemeral","isEphemeral","boolean"),this._inviteUserIds=[],this.addUsers=function(e){if(!Array.isArray(e))throw new p("Invalid parameter.",J.INVALID_PARAMETER);for(var n=e.length,t=[],s=0;s<n;s++){if(!e[s].hasOwnProperty("userId"))throw t=[],new p("Invalid parameter.",J.INVALID_PARAMETER);t.push(e[s].userId)}this._inviteUserIds=this._inviteUserIds.concat(t)},this.addUser=function(e){if(!e.hasOwnProperty("userId"))throw new p("Invalid parameter.",J.INVALID_PARAMETER);this._inviteUserIds.push(e.userId)},this.addUserIds=function(e){if(!Array.isArray(e))throw new p("Invalid parameter.",J.INVALID_PARAMETER);for(var n=e.length,t=[],s=0;s<n;s++){if("string"!=typeof e[s])throw t=[],new p("Invalid parameter.",J.INVALID_PARAMETER);t.push(e[s])}this._inviteUserIds=this._inviteUserIds.concat(t)},this.addUserId=function(e){if("string"!=typeof e)throw new p("Invalid parameter.",J.INVALID_PARAMETER);this._inviteUserIds.push(e)}},ne=function(){this._message=null,$(this,"_message","message","string"),this._targetLanguages=null,c?this.targetLanguages=this._targetLanguages:Object.defineProperty(this,"targetLanguages",{get:function(){return this._targetLanguages},set:function(e){if(!Array.isArray(e))throw new p("Invalid parameter.",J.INVALID_PARAMETER);for(var n=0;n<e.length;n++)if("string"!=typeof e[n])throw this._targetLanguages=[],new p("Invalid parameter.",J.INVALID_PARAMETER);this._targetLanguages=e}}),this._data=null,$(this,"_data","data","string"),this._customType=null,$(this,"_customType","customType","string"),this._mentionedIds=[],this._mentionedUsers=null,c?this.mentionedUsers=this._mentionedUsers:Object.defineProperty(this,"mentionedUsers",{get:function(){return this._mentionedUsers},set:function(e){if(!Array.isArray(e))throw new p("Invalid parameter.",J.INVALID_PARAMETER);for(var n=[],t=0;t<e.length;t++){if(!e[t].hasOwnProperty("userId"))throw n=[],new p("Invalid parameter.",J.INVALID_PARAMETER);n.push(e[t].userId)}this._mentionedIds=n}}),this._mentionedUserIds=null,c?this.mentionedUserIds=this._mentionedUserIds:Object.defineProperty(this,"mentionedUserIds",{get:function(){return this._mentionedUserIds},set:function(e){if(!Array.isArray(e))throw new p("Invalid parameter.",J.INVALID_PARAMETER);for(var n=0;n<e.length;n++)if("string"!=typeof e[n])throw new p("Invalid parameter.",J.INVALID_PARAMETER);this._mentionedIds=e}})},te=function(){this._file=null,c?this.file=this._file:Object.defineProperty(this,"file",{get:function(){return this._file},set:function(e){if("string"==typeof e||"object"!=typeof e)throw new p("Invalid parameter.",J.INVALID_PARAMETER);this._fileUrl=null,this._file=e}}),this._fileUrl=null,c?this.fileUrl=this._fileUrl:Object.defineProperty(this,"fileUrl",{get:function(){return this._fileUrl},set:function(e){if("string"!=typeof e)throw new p("Invalid parameter.",J.INVALID_PARAMETER);this._file=null,this._fileUrl=e}}),this._thumbnailSizes=null,c?this.thumbnailSizes=this._thumbnailSizes:Object.defineProperty(this,"thumbnailSizes",{get:function(){return this._thumbnailSizes},set:function(e){if(!Array.isArray(e))throw new p("Invalid parameter.",J.INVALID_PARAMETER);for(var n=0;n<e.length;n++)if("object"!=typeof e[n]||"number"!=typeof e[n].maxWidth||"number"!=typeof e[n].maxHeight)throw this._thumbnailSizes=[],new p("Invalid parameter.",J.INVALID_PARAMETER);this._thumbnailSizes=e}}),this._fileName=null,$(this,"_fileName","fileName","string"),this._mimeType=null,$(this,"_mimeType","mimeType","string"),this._fileSize=null,$(this,"_fileSize","fileSize","number"),this._data=null,$(this,"_data","data","string"),this._customType=null,$(this,"_customType","customType","string"),this._mentionedIds=[],this._mentionedUsers=null,c?this.mentionedUsers=this._mentionedUsers:Object.defineProperty(this,"mentionedUsers",{get:function(){return this._mentionedUsers},set:function(e){if(!Array.isArray(e))throw new p("Invalid parameter.",J.INVALID_PARAMETER);for(var n=[],t=0;t<e.length;t++){if(!e[t].hasOwnProperty("userId"))throw n=[],new p("Invalid parameter.",J.INVALID_PARAMETER);n.push(e[t].userId)}this._mentionedIds=n}}),this._mentionedUserIds=null,c?this.mentionedUserIds=this._mentionedUserIds:Object.defineProperty(this,"mentionedUserIds",{get:function(){return this._mentionedUserIds},set:function(e){if(!Array.isArray(e))throw new p("Invalid parameter.",J.INVALID_PARAMETER);for(var n=[],t=0;t<e.length;t++){if("string"!=typeof e[t])throw n=[],new p("Invalid parameter.",J.INVALID_PARAMETER);n.push(e[t])}this._mentionedIds=n}})},se=function(r){var a=se.getInstance();if(a)return a;try{if(!r.hasOwnProperty("appId"))return e.log("Must be set appId"),{}}catch(n){return e.log("Must be set appId"),{}}this.GCMPushToken="",this.APNSPushToken="",this.PUSH_TEMPLATE_DEFAULT="default",this.PUSH_TEMPLATE_ALTERNATIVE="alternative",this.isSessionOpened=!1,this.pushTokenRegistrationState={SUCCESS:"success",PENDING:"pending",ERROR:"error"},this.loginTimer,this.onLoginTimerCancel,this.globalTimer,this.reconnectTimer,this.onReconnectTimerCancel,this.currentUser=null,this.getCurrentUserId=function(){return se.getInstance().currentUser?se.getInstance().currentUser.userId:null},this.wsClient,this.connectionState={CONNECTING:"CONNECTING",OPEN:"OPEN",CLOSING:"CLOSING",CLOSED:"CLOSED"},this.ConnectionState=this.connectionState,this.BaseChannel=A,this.User=G,this.Member=V,this.OpenChannel=w,this.GroupChannel=H,this.UserMessage=D,this.FileMessage=M,this.AdminMessage=O,this.userEventHandlers={},this.channelHandlers={},this.connectionHandlers={},this.connectionCallback=[],this.GroupChannelParams=ee,this.FileMessageParams=te,this.UserMessageParams=ne;var i={};y=r.appId,re=this,(X=Z.getInstance())||(X=new Z),this.Options={UseMemberAsMessageSender:!1},this.customApiHost=null,this.customWsHost=null,this.UserEventHandler=function(){this.onFriendsDiscovered=function(e){}},this.addUserEventHandler=function(e,n){se.getInstance().userEventHandlers[e]=n},this.removeUserEventHandler=function(e){delete se.getInstance().userEventHandlers[e]},this.removeAllUserEventHandler=function(){se.getInstance().userEventHandlers={}},this.ChannelHandler=function(){this.onMessageReceived=function(e,n){},this.onMessageUpdated=function(e,n){},this.onMessageDeleted=function(e,n){},this.onReadReceiptUpdated=function(e){},this.onTypingStatusUpdated=function(e){},this.onUserJoined=function(e,n){},this.onUserLeft=function(e,n){},this.onUserEntered=function(e,n){},this.onUserExited=function(e,n){},this.onUserMuted=function(e,n){},this.onUserUnmuted=function(e,n){},this.onUserBanned=function(e,n){},this.onUserUnbanned=function(e,n){},this.onChannelFrozen=function(e){},this.onChannelUnfrozen=function(e){},this.onChannelChanged=function(e){},this.onChannelDeleted=function(e){},this.onUserReceivedInvitation=function(e,n,t){},this.onUserDeclinedInvitation=function(e,n,t){},this.onMetaDataCreated=function(e,n){},this.onMetaDataUpdated=function(e,n){},this.onMetaDataDeleted=function(e,n){},this.onMetaCountersCreated=function(e,n){},this.onMetaCountersUpdated=function(e,n){},this.onMetaCountersDeleted=function(e,n){},this.onChannelHidden=function(e){},this.onMentionReceived=function(e,n){}},this.addChannelHandler=function(e,n){se.getInstance().channelHandlers[e]=n},this.removeChannelHandler=function(e){delete se.getInstance().channelHandlers[e]},this.removeAllChannelHandlers=function(){se.getInstance().channelHandlers={}},this.ConnectionHandler=function(){this.onReconnectStarted=function(){},this.onReconnectSucceeded=function(){},this.onReconnectFailed=function(){}},this.addConnectionHandler=function(e,n){se.getInstance().connectionHandlers[e]=n},this.removeConnectionHandler=function(e){delete se.getInstance().connectionHandlers[e]},this.removeAllConnectionHandlers=function(){se.getInstance().connectionHandlers={}},this.createUserListQuery=function(e){return e?new z(z.FILTERED_USER,e):new z(z.ALL_USER)},this.createBlockedUserListQuery=function(){return new z(z.BLOCKED_USER)},this.getApplicationId=function(){return y},this.getDebugMode=function(){return n},this.setDebugMode=function(e){n=e},this.setAPIHost=function(e){s=e},this.setWSHost=function(e){t=e},this.clearCurrentApiHost=function(){this.customApiHost=null},this.getCurrentApiHost=function(){return this.customApiHost?this.customApiHost:s},this.clearCurrentWsHost=function(){this.customWsHost=null},this.getCurrentWsHost=function(){return this.customWsHost?this.customWsHost:t},this.setErrorFirstCallback=function(e){v=e},this.getConnectionState=function(){if(!se.getInstance())return this.connectionState.CLOSED;try{return se.getInstance().wsClient?se.getInstance().isSessionOpened?se.getInstance().wsClient.getConnectionState():se.getInstance().connectionState.CONNECTING:se.getInstance().connectionState.CLOSED}catch(e){return se.getInstance().connectionState.CLOSED}},this.hasLoggedIn=function(){return se.getInstance().currentUser&&Z.getInstance().sessionKey};var l=function(n){var t=new Y(n);if(t.requestId){var s=(d=t.requestId,i.hasOwnProperty(d)?i[d]:null);if(null==s)return;clearTimeout(s.timer);var r=s.handler;if(r)if("EROR"===t.command){var a=t.getJsonElement(),l=a.code,u=a.message;r(t,new p(u,l))}else r(t,null)}else{var d;switch(t.command){case"LOGI":if(se.getInstance().loginTimer){clearTimeout(se.getInstance().loginTimer),se.getInstance().loginTimer=null,se.getInstance().onLoginTimerCancel=null;var h=t.getJsonElement();if(h.hasOwnProperty("error")){se.getInstance().isSessionOpened=!1;l=h.code,u=h.message;se.getInstance().loginHandler(null,new p(u,l))}else se.getInstance().isSessionOpened=!0,h.hasOwnProperty("key")&&(Z.getInstance().sessionKey=h.key),h.hasOwnProperty("ekey")&&(Z.getInstance().ekey=h.ekey),h.hasOwnProperty("user_id")&&(se.getInstance().currentUser=new G(h)),se.getInstance().loginHandler(se.getInstance().currentUser,null)}break;case"MESG":case"FILE":case"BRDM":case"ADMM":var I="",_=!1;if("MESG"===t.command?I=new D(t.getJsonElement()):"FILE"===t.command?I=new M(t.getJsonElement()):(I=new O(t.getJsonElement()),t.getJsonElement().hasOwnProperty("silent")&&(_=t.getJsonElement().silent)),!I)return;if(I.isGroupChannel()){var E=H.cachedChannels.hasOwnProperty(I.channelUrl);H.getChannel(I.channelUrl,function(e,n){if(v){var t=e;e=n,n=t}if(n)r&&r(null,n);else{if(e.isHidden=!1,H.cachedChannels[e.url]=e,I._sender&&e.memberMap.hasOwnProperty(I._sender.userId)){var s=e.memberMap[I._sender.userId];s.nickname!==I._sender.nickname&&(s.nickname=I._sender.nickname),s.profileUrl!==I._sender.profileUrl&&(s.profileUrl=I._sender.profileUrl)}var a=se.getInstance().currentUser;if(a&&I._sender&&a.userId===I._sender.userId&&(a.nickname!==I._sender.nickname&&(a.nickname=I._sender.nickname),a.profileUrl!==I._sender.profileUrl&&(a.profileUrl=I._sender.profileUrl)),!_&&!e.isEphemeral){E&&(e.updatedLocal?(e.lastMessage=I,I.sender&&I.sender.userId===se.getInstance().getCurrentUserId()||e.unreadMessageCount++):(!e.lastMessage||e.lastMessage.createdAt<I.createdAt)&&(e.updatedLocal=!0,e.lastMessage=I,I.sender&&I.sender.userId===se.getInstance().getCurrentUserId()||e.unreadMessageCount++));for(var i in se.getInstance().channelHandlers){(o=se.getInstance().channelHandlers[i]).onChannelChanged(e)}}var l=!1;for(var i in I.mentionedUsers)if(I.mentionedUsers[i].userId===se.getInstance().getCurrentUserId()){l=!0;break}for(var i in se.getInstance().channelHandlers){var o;(o=se.getInstance().channelHandlers[i]).onMessageReceived(e,I),l&&o.onMentionReceived(e,I)}}})}else w.getChannel(I.channelUrl,function(e,n){if(v){var t=e;e=n,n=t}if(n)r&&r(null,n);else{var s=!1;for(var a in I.mentionedUsers)if(I.mentionedUsers[a].userId===se.getInstance().getCurrentUserId()){s=!0;break}for(var a in se.getInstance().channelHandlers){var i=se.getInstance().channelHandlers[a];w.enteredChannels[e.url]&&i.onMessageReceived(e,I),s&&i.onMentionReceived(e,I)}}});break;case"MEDI":case"FEDI":case"AEDI":I="";if(!(I="MEDI"===t.command?new D(t.getJsonElement()):"FEDI"===t.command?new M(t.getJsonElement()):new O(t.getJsonElement())))return;I.isGroupChannel()?H.getChannel(I.channelUrl,function(e,n){if(v){var t=e;e=n,n=t}if(n)r&&r(null,n);else{if(I._sender&&e.memberMap.hasOwnProperty(I._sender.userId)){var s=e.memberMap[I._sender.userId];s.nickname!==I._sender.nickname&&(s.nickname=I._sender.nickname),s.profileUrl!==I._sender.profileUrl&&(s.profileUrl=I._sender.profileUrl)}var a=se.getInstance().currentUser;a&&I._sender&&a.userId===I._sender.userId&&(a.nickname!==I._sender.nickname&&(a.nickname=I._sender.nickname),a.profileUrl!==I._sender.profileUrl&&(a.profileUrl=I._sender.profileUrl));for(var i in se.getInstance().channelHandlers){se.getInstance().channelHandlers[i].onMessageUpdated(e,I)}}}):w.getChannel(I.channelUrl,function(e,n){if(v){var t=e;e=n,n=t}if(n)r&&r(null,n);else for(var s in se.getInstance().channelHandlers){se.getInstance().channelHandlers[s].onMessageUpdated(e,I)}});break;case"READ":var f=new function(e){e&&(this.reader=new G(e.user),this.timestamp=parseInt(e.ts),this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):b.CHANNEL_TYPE_GROUP)}(t.getJsonElement());E=H.cachedChannels.hasOwnProperty(f.channelUrl);H.getChannel(f.channelUrl,function(e,n){if(v){var t=e;e=n,n=t}if(n)r&&r(null,n);else if(f.reader.userId===se.getInstance().getCurrentUserId()){if(E){if(e.unreadMessageCount>0){e.unreadMessageCount=0;for(var s in se.getInstance().channelHandlers){se.getInstance().channelHandlers[s].onChannelChanged(e)}}}else if(0===e.unreadMessageCount)for(var s in se.getInstance().channelHandlers){se.getInstance().channelHandlers[s].onChannelChanged(e)}}else{e.updateReadReceipt(f.reader.userId,f.timestamp);for(var s in se.getInstance().channelHandlers){se.getInstance().channelHandlers[s].onReadReceiptUpdated(e)}}});break;case"TPST":case"TPEN":case"MTIO":break;case"SYEV":c(t);break;case"USEV":o(t);break;case"DELM":var A=t.getJsonElement(),g=String(A.channel_type),m=String(A.channel_url),N=String(A.msg_id);switch(g){case b.CHANNEL_TYPE_OPEN:w.getChannel(m,function(n,t){if(v){var s=n;n=t,t=s}if(t)e.log("Discard a command.");else for(var r in se.getInstance().channelHandlers){se.getInstance().channelHandlers[r].onMessageDeleted(n,N)}});break;case b.CHANNEL_TYPE_GROUP:H.getChannel(m,function(n,t){if(v){var s=n;n=t,t=s}if(t)e.log("Discard a command.");else for(var r in se.getInstance().channelHandlers){se.getInstance().channelHandlers[r].onMessageDeleted(n,N)}})}}}},o=function(e){var n=new k(e.getJsonElement());switch(n.category){case F.CATEGORY_USER_BLOCK:case F.CATEGORY_USER_UNBLOCK:var t=n.data.blocker.user_id,s=n.data.blockee.user_id;Object.keys(H.cachedChannels).forEach(function(e){var r=H.cachedChannels[e];try{se.getInstance().getCurrentUserId()===t?r.memberMap[s].isBlockedByMe=n.category===F.CATEGORY_USER_BLOCK:se.getInstance().getCurrentUserId()===s&&(r.memberMap[t].isBlockingMe=n.category===F.CATEGORY_USER_BLOCK)}catch(e){}});break;case F.CATEGORY_FRIEND_DISCOVERED:var r=n.data.friend_discoveries.map(function(e){return new G(e)});for(var a in se.getInstance().userEventHandlers){se.getInstance().userEventHandlers[a].onFriendsDiscovered(r)}}},c=function(n){var t=new k(n.getJsonElement());switch(t.category){case k.CATEGORY_CHANNEL_JOIN:case k.CATEGORY_CHANNEL_LEAVE:H.getChannel(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else{var i=new G(t.data);if(t.category===k.CATEGORY_CHANNEL_JOIN){t.data.state=V.JOINED,s.addMember(new V(t.data)),i.userId===se.getInstance().getCurrentUserId()&&(s.myMemberState="joined",H.cachedChannels[s.url]=s);for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onUserJoined(s,i)}}else{i.userId===se.getInstance().getCurrentUserId()&&(s.isPublic||H.removeCachedChannel(t.channelUrl));s.removeMember(i);s.myMemberState="none",H.cachedChannels[s.url]=s;for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onUserLeft(s,i)}}}});break;case k.CATEGORY_CHANNEL_INVITE:H.getChannel(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else{var i=null;t.data&&t.data.inviter&&!I(t.data.inviter)&&(i=new G(t.data.inviter));var l=[];for(var o in t.data.invitees){t.data.invitees[o].state=V.INVITED;var c=new V(t.data.invitees[o]);l.push(c),s.addMember(c),c.userId===se.getInstance().getCurrentUserId()&&(s.isHidden=!1,"joined"!==s.myMemberState&&(s.myMemberState="invited"),H.cachedChannels[s.url]=s)}for(var o in se.getInstance().channelHandlers){se.getInstance().channelHandlers[o].onUserReceivedInvitation(s,i,l)}}});break;case k.CATEGORY_CHANNEL_DECLINE_INVITE:H.getChannel(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else{var i=null;t.data&&t.data.inviter&&!I(t.data.inviter)&&(i=new G(t.data.inviter));var l=new G(t.data.invitee);l.userId===se.getInstance().getCurrentUserId()&&(s.isPublic||H.removeCachedChannel(t.channelUrl)),s.removeMember(l),s.myMemberState="none",H.cachedChannels[s.url]=s;for(var o in se.getInstance().channelHandlers){se.getInstance().channelHandlers[o].onUserDeclinedInvitation(s,i,l)}}});break;case k.CATEGORY_TYPING_START:case k.CATEGORY_TYPING_END:H.getChannel(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else{var i=new G(t.data);t.category===k.CATEGORY_TYPING_START?s.updateTypingStatus(i,!0):s.updateTypingStatus(i,!1);for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onTypingStatusUpdated(s)}}});break;case k.CATEGORY_CHANNEL_ENTER:case k.CATEGORY_CHANNEL_EXIT:w.getChannel(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else{t.data.hasOwnProperty("participant_count")&&(s.participantCount=t.data.participant_count);var i=new G(t.data);if(t.category===k.CATEGORY_CHANNEL_ENTER)for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onUserEntered(s,i)}else for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onUserExited(s,i)}}});break;case k.CATEGORY_USER_CHANNEL_MUTE:case k.CATEGORY_USER_CHANNEL_UNMUTE:t.isOpenChannel()?w.getChannel(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else{var i=new G(t.data);if(t.category===k.CATEGORY_USER_CHANNEL_MUTE)for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onUserMuted(s,i)}else for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onUserUnmuted(s,i)}}}):H.getChannel(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else{var i=new G(t.data);if(t.category===k.CATEGORY_USER_CHANNEL_MUTE)for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onUserMuted(s,i)}else for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onUserUnmuted(s,i)}}});break;case k.CATEGORY_USER_CHANNEL_BAN:case k.CATEGORY_USER_CHANNEL_UNBAN:t.isOpenChannel()?w.getChannel(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else{var i=new G(t.data);if(t.category===k.CATEGORY_USER_CHANNEL_BAN)for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onUserBanned(s,i)}else for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onUserUnbanned(s,i)}}}):H.getChannel(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else{var i=new G(t.data);if(t.category===k.CATEGORY_USER_CHANNEL_BAN)for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onUserBanned(s,i)}else for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onUserUnbanned(s,i)}}});break;case k.CATEGORY_CHANNEL_FREEZE:case k.CATEGORY_CHANNEL_UNFREEZE:t.isOpenChannel()?w.getChannel(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else if(s.isFrozen=t.data.freeze,w.cachedChannels[s.url]=s,t.category===k.CATEGORY_CHANNEL_FREEZE)for(var i in se.getInstance().channelHandlers){se.getInstance().channelHandlers[i].onChannelFrozen(s)}else for(var i in se.getInstance().channelHandlers){se.getInstance().channelHandlers[i].onChannelUnfrozen(s)}}):H.getChannel(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else if(s.isFrozen=t.data.freeze,H.cachedChannels[s.url]=s,t.category===k.CATEGORY_CHANNEL_FREEZE)for(var i in se.getInstance().channelHandlers){se.getInstance().channelHandlers[i].onChannelFrozen(s)}else for(var i in se.getInstance().channelHandlers){se.getInstance().channelHandlers[i].onChannelUnfrozen(s)}});break;case k.CATEGORY_CHANNEL_DELETED:if(t.isGroupChannel()){H.removeCachedChannel(t.channelUrl);for(var s in se.getInstance().channelHandlers){se.getInstance().channelHandlers[s].onChannelDeleted(t.channelUrl,"group")}}else{w.removeCachedChannel(t.channelUrl);for(var s in se.getInstance().channelHandlers){se.getInstance().channelHandlers[s].onChannelDeleted(t.channelUrl,"open")}}break;case k.CATEGORY_CHANNEL_PROP_CHANGED:t.isOpenChannel()?w.getChannelWithoutCache(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else for(var i in se.getInstance().channelHandlers){se.getInstance().channelHandlers[i].onChannelChanged(s)}}):H.getChannelWithoutCache(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else for(var i in se.getInstance().channelHandlers){se.getInstance().channelHandlers[i].onChannelChanged(s)}});break;case k.CATEGORY_CHANNEL_META_DATA_CHANGED:case k.CATEGORY_CHANNEL_META_COUNTERS_CHANGED:var r=t.data.hasOwnProperty("created"),a=t.data.hasOwnProperty("updated"),i=t.data.hasOwnProperty("deleted");t.isOpenChannel()?w.getChannel(t.channelUrl,function(s,l){if(v){var o=s;s=l,l=o}if(l)e.log("Discard a command: "+n.command+":"+t.category);else for(var c in se.getInstance().channelHandlers){var u=se.getInstance().channelHandlers[c];t.category===k.CATEGORY_CHANNEL_META_DATA_CHANGED?(r&&u.onMetaDataCreated(s,t.data.created),a&&u.onMetaDataUpdated(s,t.data.updated),i&&u.onMetaDataDeleted(s,t.data.deleted)):(r&&u.onMetaCountersCreated(s,t.data.created),a&&u.onMetaCountersUpdated(s,t.data.updated),i&&u.onMetaCountersDeleted(s,t.data.deleted))}}):H.getChannel(t.channelUrl,function(s,l){if(v){var o=s;s=l,l=o}if(l)e.log("Discard a command: "+n.command+":"+t.category);else for(var c in se.getInstance().channelHandlers){var u=se.getInstance().channelHandlers[c];t.category===k.CATEGORY_CHANNEL_META_DATA_CHANGED?(r&&u.onMetaDataCreated(s,t.data.created),a&&u.onMetaDataUpdated(s,t.data.updated),i&&u.onMetaDataDeleted(s,t.data.deleted)):(r&&u.onMetaCountersCreated(s,t.data.created),a&&u.onMetaCountersUpdated(s,t.data.updated),i&&u.onMetaCountersDeleted(s,t.data.deleted))}});break;case k.CATEGORY_CHANNEL_HIDE:H.getChannel(t.channelUrl,function(s,r){if(v){var a=s;s=r,r=a}if(r)e.log("Discard a command: "+n.command+":"+t.category);else{if(s.isHidden=!0,t.data&&t.data.hasOwnProperty("hide_previous_messages")&&t.data.hide_previous_messages&&H.cachedChannels){var i=H.cachedChannels[s.url];i.unreadMessageCount=0,H.cachedChannels[s.url]=i}for(var l in se.getInstance().channelHandlers){se.getInstance().channelHandlers[l].onChannelHidden(s)}}})}};this.setPushTemplate=function(e,n){!e||e!==this.PUSH_TEMPLATE_DEFAULT&&e!==this.PUSH_TEMPLATE_ALTERNATIVE?S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n):this.currentUser?Z.getInstance().setPushTemplate(this.getCurrentUserId(),e,function(e,t){if(t)S(null,t,n);else{var s=e.name.toString();S(s,null,n)}}):S(null,new p("Connection must be made before you set push template",J.CONNECTION_REQUIRED),n)},this.getPushTemplate=function(e){this.currentUser?Z.getInstance().getPushTemplate(this.getCurrentUserId(),function(n,t){if(t)S(null,t,e);else{var s=n.name.toString();S(s,null,e)}}):S(null,new p("Connection must be made before you get push template",J.CONNECTION_REQUIRED),e)},this.setChannelInvitationPreference=function(e,n){"boolean"!=typeof e&&S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n),Z.getInstance().setChannelInvitationPreference(this.getCurrentUserId(),e,function(e,t){t?S(null,t,n):S({autoAccept:e.auto_accept},null,n)})},this.getChannelInvitationPreference=function(e){Z.getInstance().getChannelInvitationPreference(this.getCurrentUserId(),function(n,t){t?S(null,t,e):S({autoAccept:n.auto_accept},null,e)})},this.connect=function(){var t=Array.prototype.slice.call(arguments),s=null,r=null,a=null;switch("function"==typeof t.slice(-1)[0]&&(a=t.pop()),t.length){case 1:s=t[0];break;case 2:s=t[0],r=t[1];break;case 3:s=t[0],this.customApiHost=t[1],this.customWsHost=t[2];break;case 4:s=t[0],r=t[1],this.customApiHost=t[2],this.customWsHost=t[3];break;default:n&&e.log("sb.connect args length error: ",arguments)}s&&0!==s.length?(se.getInstance().reconnectTimer&&(clearTimeout(se.getInstance().reconnectTimer),se.getInstance().reconnectTimer=null,se.getInstance().onReconnectTimerCancel=null),se.getInstance().getConnectionState()===this.connectionState.OPEN&&se.getInstance().getCurrentUserId()===s?S(se.getInstance().currentUser,null,a):(se.getInstance().connectionCallback.push(a),1===se.getInstance().connectionCallback.length&&(E(!0,null),g(s,r)))):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),a)};var u=!1,d=!1,h=!0;this.setBackgroundState=function(){!u&&h&&(u=!0,this.getConnectionState()!==this.connectionState.CLOSED?(d=!0,E(!1,null)):d=!1)},this.setForegroundState=function(){u&&h&&(u=!1,d&&this.currentUser&&(T=0,f(this.getCurrentUserId(),!0)))},this.disableStateChange=function(){h=!1},this.enableStateChange=function(){h=!0},this.disconnect=function(e){E(!0,e)},this.reconnect=function(){if(!Z.getInstance().sessionKey||!this.currentUser)return!1;var e=!0;return T>0&&(e=!1),E(!1,null),T=0,f(this.getCurrentUserId(),e),!0};var E=function(e,n){var t=this;se.getInstance().loginTimer&&(clearTimeout(se.getInstance().loginTimer),se.getInstance().onLoginTimerCancel&&(se.getInstance().onLoginTimerCancel(),se.getInstance().onLoginTimerCancel=null),se.getInstance().loginTimer=null),se.getInstance().reconnectTimer&&(clearTimeout(se.getInstance().reconnectTimer),se.getInstance().onReconnectTimerCancel&&(se.getInstance().onReconnectTimerCancel(),se.getInstance().onReconnectTimerCancel=null),se.getInstance().reconnectTimer=null),se.getInstance().wsClient&&(T=0,se.getInstance().wsClient.disconnect(!0),se.getInstance().wsClient=null),function(){if(e){w.clearEnteredChannels(),w.clearCache(),H.clearCache(),se.getInstance().globalTimer&&(clearTimeout(t.globalTimer),se.getInstance().globalTimer=null);for(var s in se.getInstance().ackStateMap)clearTimeout(se.getInstance().ackStateMap[s].timer);se.getInstance().ackStateMap={},se.getInstance().currentUser=null,Z.getInstance().sessionKey=null,Z.getInstance().ekey=null}S(null,null,n)}()},f=function(t,s){if(se.getInstance().reconnectTimer)n&&e.log("still reconnecting");else{if((T+=1)<=1){if(s)for(var r in se.getInstance().connectionHandlers){se.getInstance().connectionHandlers[r].onReconnectStarted(r)}P=0}else P=3e3*Math.pow(2,T-2);if(!t||!Z.getInstance().sessionKey||T>=6){E(!1,null),T=0;for(var r in se.getInstance().connectionHandlers){se.getInstance().connectionHandlers[r].onReconnectFailed(r)}return}se.getInstance().onReconnectTimerCancel=function(){T=0},se.getInstance().reconnectTimer=setTimeout(function(){se.getInstance().reconnectTimer=null,se.getInstance().onReconnectTimerCancel=null,se.getInstance().wsClient&&se.getInstance().wsClient.disconnect(!0);var s=new j.WSClientHandler;se.getInstance().wsClient=new j(s),se.getInstance().loginHandler=function(e){T=0;for(var n in w.enteredChannels){w.enteredChannels[n].enter()}for(var n in se.getInstance().connectionHandlers){se.getInstance().connectionHandlers[n].onReconnectSucceeded(n)}},s.onOpen=function(){n&&e.log("reconnectWS onOpen"),se.getInstance().loginTimer=setTimeout(function(){n&&e.log("reconnectWS loginTimer timedout"),se.getInstance().loginTimer=null,f(t,!0)},1e4),se.getInstance().onLoginTimerCancel=null},s.onMessage=function(e){l(e)},s.onError=function(){n&&e.log("reconnectWS onError"),f(t,!0)},s.onClose=function(){n&&e.log("reconnectWS onClose")};var r=se.getInstance().getCurrentApiHost();Z.getInstance().checkRouting(function(e,n){n?f(t,!0):(r!==e.API_HOST&&U(e.API_HOST,{},"GET",{},function(){}),se.getInstance().wsClient.connect(t,null,e.WS_HOST))})},P)}},g=function(t,s){var r=new j.WSClientHandler;se.getInstance().wsClient=new j(r),r.onMessage=function(e){l(e)},se.getInstance().loginHandler=function(e,n){if(n)se.getInstance().disconnect(null),se.getInstance().connectionCallback.forEach(function(e){S(null,n,e)}),se.getInstance().connectionCallback=[];else{clearTimeout(se.getInstance().globalTimer);var t=function(){if(H.cachedChannels)for(var e in H.cachedChannels){var n=H.cachedChannels[e];if(n.invalidateTypingStatus())for(var s in se.getInstance().channelHandlers){se.getInstance().channelHandlers[s].onTypingStatusUpdated(n)}}se.getInstance().globalTimer=setTimeout(function(){t()},1e3)};t();var s=se.getInstance().connectionCallback;se.getInstance().connectionCallback=[],s.forEach(function(n){S(e,null,n)}),s=[]}},r.onOpen=function(e){se.getInstance().loginTimer=setTimeout(function(){se.getInstance().loginTimer=null,se.getInstance().onLoginTimerCancel=null,se.getInstance().disconnect(null),se.getInstance().connectionCallback.forEach(function(e){S(null,new p("Connection timeout.",J.LOGIN_TIMEOUT),e)}),se.getInstance().connectionCallback=[]},1e4),se.getInstance().onLoginTimerCancel=function(){se.getInstance().connectionCallback.forEach(function(e){S(null,new p("Connection Cancelled.",J.REQUEST_FAILED),e)}),se.getInstance().connectionCallback=[]}},r.onError=function(s){n&&e.log("WSClientHandler.onError"),Z.getInstance().sessionKey?f(t,!0):(se.getInstance().connectionCallback.forEach(function(e){S(null,new p("Websocket connection failed.",J.WEBSOCKET_CONNECTION_FAILED),e)}),se.getInstance().connectionCallback=[])},r.onClose=function(t){n&&e.log("WSClientHandler.onClose")},Z.getInstance().checkRouting(function(e,n){if(n)return se.getInstance().connectionCallback.forEach(function(e){S(null,new p("Connection routing failed.",J.REQUEST_FAILED),e)}),void(se.getInstance().connectionCallback=[]);U(e.API_HOST,{},"GET",{},function(){}),se.getInstance().wsClient.connect(t,s,e.WS_HOST)})};this.sendCommand=function(e,n){if(se.getInstance().hasLoggedIn())if(null!=se.getInstance().wsClient&&se.getInstance().wsClient.getConnectionState()===se.getInstance().connectionState.OPEN)if(e.isAckRequired()){var t=e.requestId,s={handler:n,timer:setTimeout(function(){n(null,new p("Command received no ack.",J.ACK_TIMEOUT)),delete i[t]},1e4)};i[t]=s,se.getInstance().wsClient.send(e,function(e,t){if(t)return clearTimeout(s.timer),void n(null,t)})}else se.getInstance().wsClient.send(e,n);else n&&n(null,new p("Connection is not valid. Please reconnect.",J.WEBSOCKET_CONNECTION_CLOSED));else n&&n(null,new p("Connection should be made first.",J.CONNECTION_REQUIRED))},this.markAsReadAll=function(e){var n=(new Date).getTime();n-H.markAsReadAllLastSentAt<1e3?S(null,new p("MarkAsRead rate limit exceeded.",J.MARK_AS_READ_RATE_LIMIT_EXCEEDED),e):(H.markAsReadAllLastSentAt=n,Z.getInstance().groupChannelMarkAsReadAll(se.getInstance().getCurrentUserId(),null,function(n,t){if(t)S(null,t,e);else{for(var s in H.cachedChannels)H.cachedChannels[s].unreadMessageCount=0;S(null,null,e)}}))},this.markAsReadWithChannelUrls=function(e,n){if(Array.isArray(e)){var t=(new Date).getTime();t-H.markAsReadAllLastSentAt<1e3?S(null,new p("MarkAsRead rate limit exceeded.",J.MARK_AS_READ_RATE_LIMIT_EXCEEDED),n):(H.markAsReadAllLastSentAt=t,Z.getInstance().groupChannelMarkAsReadAll(se.getInstance().getCurrentUserId(),e,function(t,s){s?S(null,s,n):(e.forEach(function(e){var n=H.cachedChannels[e];n&&(n.unreadMessageCount=0,H.cachedChannels[e]=n)}),S(null,null,n))}))}else S(null,new p("Invalid parameter.",J.INVALID_PARAMETER),n)},this.updateCurrentUserInfoWithProfileImage=function(e,n,t){var s=this;n?Z.getInstance().updateCurrentUserInfoWithFile(s.getCurrentUserId(),e,n,function(r,a){a?S(null,a,t):(s.currentUser&&(e&&(s.currentUser.nickname=e),n&&(s.currentUser.profileUrl=r.profile_url)),S(s.currentUser,null,t))}):s.updateCurrentUserInfo(e,null,t)},this.updateCurrentUserInfo=function(e,n,t){var s=this;Z.getInstance().updateUserInfo(s.getCurrentUserId(),e,n,function(r,a){a?S(null,a,t):(s.currentUser&&(e&&(s.currentUser.nickname=e),n&&(s.currentUser.profileUrl=n)),S(s.currentUser,null,t))})},this.getPendingGCMToken=function(){return this.GCMPushToken},this.getPendingAPNSToken=function(){return this.APNSPushToken},this.registerGCMPushTokenForCurrentUser=function(e,n){var t=this;if(e)return this.currentUser?void Z.getInstance().registerGCMPushToken(this.getCurrentUserId(),e,function(e,s){s?S(t.pushTokenRegistrationState.ERROR,s,n):(t.GCMPushToken="",S(t.pushTokenRegistrationState.SUCCESS,null,n))}):(t.GCMPushToken=e,void S(t.pushTokenRegistrationState.PENDING,null,n));S(t.pushTokenRegistrationState.ERROR,new p("Invalid token",J.INVALID_PARAMETER),n)},this.unregisterGCMPushTokenForCurrentUser=function(e,n){e?Z.getInstance().unregisterGCMPushToken(this.getCurrentUserId(),e,function(e,t){S(null,t||null,n)}):S(null,new p("Invalid token",J.INVALID_PARAMETER),n)},this.unregisterGCMPushTokenAllForCurrentUser=function(e){Z.getInstance().unregisterGCMPushTokenAll(this.getCurrentUserId(),function(n,t){S(null,t||null,e)})},this.registerAPNSPushTokenForCurrentUser=function(e,n){var t=this;if(e)return this.currentUser?void Z.getInstance().registerAPNSPushToken(this.getCurrentUserId(),e,function(e,s){s?S(t.pushTokenRegistrationState.ERROR,s,n):(t.APNSPushToken="",S(t.pushTokenRegistrationState.SUCCESS,null,n))}):(t.APNSPushToken=e,void S(t.pushTokenRegistrationState.PENDING,null,n));S(t.pushTokenRegistrationState.ERROR,new p("Invalid token",J.INVALID_PARAMETER),n)},this.unregisterAPNSPushTokenForCurrentUser=function(e,n){e?Z.getInstance().unregisterAPNSPushToken(this.getCurrentUserId(),e,function(e,t){S(null,t||null,n)}):S(null,new p("Invalid token",J.INVALID_PARAMETER),n)},this.unregisterAPNSPushTokenAllForCurrentUser=function(e){Z.getInstance().unregisterAPNSPushTokenAll(this.getCurrentUserId(),function(n,t){S(null,t||null,e)})},this.unregisterPushTokenAllForCurrentUser=function(e){Z.getInstance().unregisterAPNSPushTokenAll(this.getCurrentUserId(),function(n,t){S(null,t||null,e)})},this.setDoNotDisturb=function(e,n,t,s,r,a,i){n<0||n>23||t<0||t>59||s<0||s>23||r<0||r>59?S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),i):Z.getInstance().setDoNotDisturb(this.getCurrentUserId(),e,n,t,s,r,a,function(e,n){if(n)S(null,n,i);else{var t={doNotDisturbOn:e.do_not_disturb,startHour:e.start_hour,startMin:e.start_min,endHour:e.end_hour,endMin:e.end_min,timezone:e.timezone};S(t,null,i)}})},this.getDoNotDisturb=function(e){Z.getInstance().getDoNotDisturb(this.getCurrentUserId(),function(n,t){if(t)S(null,t,e);else{var s={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone};S(s,null,e)}})},this.blockUser=function(e,n){"object"==typeof e?this.blockUserWithUserId(e.userId,n):S(null,new p("You have to pass user object.",J.INVALID_PARAMETER),n)},this.blockUserWithUserId=function(e,n){this.getCurrentUserId()!==e?Z.getInstance().blockUser(this.getCurrentUserId(),e,function(e,t){t?S(null,t,n):S(new G(e),null,n)}):S(null,new p("You can not block yourself.",J.INVALID_PARAMETER),n)},this.unblockUser=function(e,n){"object"==typeof e?this.unblockUserWithUserId(e.userId,n):S(null,new p("You have to pass user object.",J.INVALID_PARAMETER),n)},this.unblockUserWithUserId=function(e,n){this.getCurrentUserId()!==e?Z.getInstance().unblockUser(this.getCurrentUserId(),e,function(e,t){S(null,t||null,n)}):S(null,new p("You can not unblock yourself.",J.INVALID_PARAMETER),n)},this.addFriends=function(e,n){if(Array.isArray(e)){Z.getInstance().addFriends(this.getCurrentUserId(),e,function(e,t){if(t)S(null,t,n);else{var s=e.users.map(function(e){return new G(e)});S(s,null,n)}})}else S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n)},this.deleteFriends=function(e,n){if(Array.isArray(e)){Z.getInstance().deleteFriends(this.getCurrentUserId(),e,function(e,t){t?S(null,t,n):S(e,null,n)})}else S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n)},this.deleteFriend=function(e,n){"string"==typeof e?this.deleteFriends([e],n):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n)},this.uploadFriendDiscoveries=function(e,n){var t=!0;for(var s in e)if(!e[s].hasOwnProperty("friendDiscoveryKey")){t=!1,S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n);break}if(t){Z.getInstance().uploadFriendDiscoveries(this.getCurrentUserId(),e,function(e,t){t?S(null,t,n):S(e,null,n)})}},this.deleteFriendDiscoveries=function(e,n){if(Array.isArray(e)){Z.getInstance().deleteFriendDiscoveries(this.getCurrentUserId(),e,function(e,t){t?S(null,t,n):S(e,null,n)})}else S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n)},this.deleteFriendDiscovery=function(e,n){"string"==typeof e?this.deleteFriendDiscoveries([e],n):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),n)},this.getFriendChangeLogsByToken=function(e,n){if("function"==typeof e&&(n=e,e=null),"function"!=typeof n)return null;Z.getInstance().getFriendChangeLogsByToken(this.getCurrentUserId(),e,function(e,t){if(t)S(null,t,n);else{var s=e.updated.map(function(e){return new G(G.build(e.user_id,e.nickname,e.profile_url,e.is_online,e.last_seen_at,e.metadata,e.is_active,e.friend_discovery_key,e.friend_name))}),r=e.deleted,a=e.has_more,i=e.next;S({updatedUsers:s,deletedUserIds:r,hasMore:a,token:i},null,n)}})},this.createFriendListQuery=function(){return new function(){var e="";this.isLoading=!1,this.hasMore=!0,this.limit=20;var n=this;this.next=function(t){_(n.limit)?n.hasMore&&(n.isLoading?S(null,new p("Query in progress.",J.QUERY_IN_PROGRESS),t):(n.isLoading=!0,Z.getInstance().friendListQuery(se.getInstance().getCurrentUserId(),e,n.limit,function(s,r){if(r)return n.isLoading=!1,void S(null,r,t);var a=s.users.map(function(e){return new G(e)});n.hasMore=s.has_more,n.isLoading=!1,e=s.next,S(a,null,t)}))):S(null,new p("Invalid arguments.",J.INVALID_PARAMETER),t)}}}},re=null;return se.getInstance=function(){return null===re?null:re},{SendBird:se}},C=null;return((f=function(e){if(e.newInstance||!C){var n=new N;C=new n.SendBird(e)}return C}).getInstance=function(){return null===C?null:C},f.version=i,{SendBird:f}).SendBird});
